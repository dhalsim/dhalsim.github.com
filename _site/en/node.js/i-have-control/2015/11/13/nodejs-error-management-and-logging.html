

<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Node.js Error Management and Logging</title>
	<meta name="author" content="Barış Aydek">

	<!-- for Google -->
	<meta name="description" content="In this article, you'll read about logging on node.js apps using Winston library and how to manage exceptions on your Express applications." />
	<meta name="keywords" content="" />

	<meta name="author" content="Barış Aydek" />
	<meta name="copyright" content="" />
	<meta name="application-name" content="Dhalsim's Place" />

	<!-- for Facebook -->
	<meta property="og:title" content="Node.js Error Management and Logging" />
	<meta property="og:type" content="article" />
	<meta property="og:image" content="http://dhalsim.github.io/assets/images/nodejs.png" />
	<meta property="og:url" content="http://dhalsim.github.io/en/node.js/i-have-control/2015/11/13/nodejs-error-management-and-logging" />
	<meta property="og:description" content="In this article, you'll read about logging on node.js apps using Winston library and how to manage exceptions on your Express applications." />

	<!-- for Twitter -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content="Node.js Error Management and Logging" />
	<meta name="twitter:description" content="In this article, you'll read about logging on node.js apps using Winston library and how to manage exceptions on your Express applications." />
	<meta name="twitter:image" content="http://dhalsim.github.io/assets/images/nodejs.png" />
	<meta name="twitter:creator" content="@mustapha_alaziz">

  <style>
	  @font-face {
			font-family: 'Allerta';
			src: url('/assets/fonts/Allerta-Regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/Allerta-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/Allerta-Regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/Allerta-Regular.woff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/Allerta-Regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/Allerta-Regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}
		@font-face {
			font-family: 'Punk';
			src: url('/assets/fonts/punk-regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/punk-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/punk-regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/punk-regularwoff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/punk-regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/punk-regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}

		@font-face {
			font-family: 'Ewert';
			src: url('/assets/fonts/Ewert-Regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/Ewert-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/Ewert-Regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/Ewert-Regularwoff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/Ewert-Regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/Ewert-Regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}
	</style>
	<link href='/assets/themes/the-program/css/style.css' rel="stylesheet" media="all">
	<link href='/assets/css/mystyles.css' rel="stylesheet" media="all">
	<link href='/assets/css/flags/flags.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title="Node.js Error Management and Logging" type="application/atom+xml">
	<style media="screen">
	.cd-top {
	  display: inline-block;
	  height: 40px;
	  width: 40px;
	  position: fixed;
	  bottom: 100px;
	  right: 10px;
	  z-index: 10;
	  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	  /* image replacement properties */
	  overflow: hidden;
	  text-indent: 100%;
	  white-space: nowrap;
	  background: rgba(232, 98, 86, 0.8) url(/assets/images/cd-top-arrow.svg) no-repeat center 50%;
	  visibility: hidden;
	  opacity: 0;
	  -webkit-transition: opacity .3s 0s, visibility 0s .3s;
	  -moz-transition: opacity .3s 0s, visibility 0s .3s;
	  transition: opacity .3s 0s, visibility 0s .3s;
	}
	.cd-top.cd-is-visible, .cd-top.cd-fade-out, .no-touch .cd-top:hover {
	  -webkit-transition: opacity .3s 0s, visibility 0s 0s;
	  -moz-transition: opacity .3s 0s, visibility 0s 0s;
	  transition: opacity .3s 0s, visibility 0s 0s;
	}
	.cd-top.cd-is-visible {
	  /* the button becomes visible */
	  visibility: visible;
	  opacity: 1;
	}
	.cd-top.cd-fade-out {
	  /* if the user keeps scrolling down, the button is out of focus and becomes less visible */
	  opacity: .5;
	}
	.no-touch .cd-top:hover {
	  background-color: #e86256;
	  opacity: 1;
	}
	@media only screen and (min-width: 768px) {
	  .cd-top {
	    right: 20px;
	    bottom: 20px;
	  }
	}
	@media only screen and (min-width: 1024px) {
	  .cd-top {
	    height: 60px;
	    width: 60px;
	    right: 30px;
	    bottom: 30px;
	  }
	}
	</style>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" charset="utf-8">
	
</head>
<body>
<a href="#0" class="cd-top cd-is-visible">Top</a>
<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
					<ul>
						<li class="logo" style="height: 249px;">
							<a href="/en">
								<img src="/assets/dhalsim_logo.gif" />
							</a>
						</li>
						<li class="logo">
							<a href="/en/">
								Dhalsim's Place
							</a>
						</li>
						<li class="archive"><a href="/en/archive.html">Archive</a></li>
						<li class="page"><a href="/en/pages.html">Pages</a></li>
						<li class="category"><a href="/en/categories.html">Categories</a></li>
						<li class="tag"><a href="/en/tags.html">Tags</a></li>
					</ul>

					<hr />
					<nav class="languageSelector">
						
							<img src="/assets/blank.gif" class="flag flag-gb" alt="English" /> English
						
						-
						
							<a href="/" ><img src="/assets/blank.gif" class="flag flag-tr" alt="Turkish" /> </a><a href="/" class="alink">Turkish</a>
						
					</nav>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					

<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Node.js Error Management and Logging</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
				<div class="toc">
					<span>Loading table of contents...</span>
					<div class="sp-circle"></div>
				</div>
			</header>

			<div class="bd">
				<div class="entry-content">
					<div class="seriesNote">
  This article is <strong>part 2</strong> of a <strong>2-part</strong> series called <strong>I Have Control</strong></p>
    <ul>
    
    
    
        

    
    
        <li class="">Part 1 -
        
            <a href="/en/node.js/i-have-control/2015/11/13/debugging-nodejs">
        
    Debugging Node.js
    
      </a>
    
        </li>
    
    
    
        

    
    
        <li class="selected">Part 2 -
        
    Node.js Error Management and Logging
    
        </li>
    
    
    
    
    
    
    
    
    </ul>
</div>

<p><br /></p>

<p>Hello, that&#39;s the new article for <strong>I Have Control</strong> series.</p>

<p>Before this one, I wrote about <a href="/en/node.js/2015/11/13/debugging-nodejs/">Node.js Debugging</a> and now in this part, we&#39;re going to dive into the <em>essential</em> <strong>logging</strong>.</p>

<p>Logging is much more important within node.js, because logging is crucial for the one of node&#39;s main goals: <em>scaling</em></p>

<!--more-->

<p>Let&#39;s think this way: Before we&#39;ve got <a href="https://en.wikipedia.org/wiki/Monolithic_application">Monolithic</a> architechtured applications and they are relatively easier to manage. Application runs on a single machine, even on some cases on same machine with the DB. So writing and reading logs was easy as just couple of files or DB tables.</p>

<p>But with the coming use of <strong>microservices</strong>, wide acceptance of multi-tier architechtures, scaling etc., logging became a thorny field.</p>

<p><strong>Clustering</strong> on multiple machines, or even on same machine with <strong>docker containers</strong>, multiple DB&#39;s like <strong>redis</strong>, <strong>mongodb</strong>, <strong>hadoop</strong> and instances of them and many more new technologies forces us to leave our safe and warm monolithic environment to this caotic one and this leads us to create radical solutions.</p>

<p>Before going that far, we need to act in an order. First things first: healty log management on node.js.</p>

<p>There are different ways to achieve this on node, though there are mandotary steps to do like <strong>levels</strong> on log messages, like catching <strong>unhandled exceptions</strong> and managing them.</p>

<p>My first recommendation is <a href="https://github.com/winstonjs/winston">Winston</a> and strange the name comes from <a href="http://www.urbandictionary.com/define.php?term=Chill+Winston">this</a> :/. By the way winston does <strong>async</strong> logging.</p>

<h1>Winston</h1>

<p>Setup:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> npm install winston --save
<span class="lineno">2</span> npm install winston-redis --save
</code></pre></div>
<h2>Levels</h2>

<p>Levels orders from most important to least: <strong><code>error: 0, warn: 1, info: 2, verbose: 3, debug: 4, silly: 5</code></strong></p>

<p>Usage:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno">1</span> <span class="c1">// default logger</span>
<span class="lineno">2</span> <span class="kd">var</span> <span class="nx">winston</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;winston&#39;</span><span class="p">);</span>
<span class="lineno">3</span> 
<span class="lineno">4</span> <span class="c1">// these are the same</span>
<span class="lineno">5</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello distributed log files!&#39;</span><span class="p">);</span>
<span class="lineno">6</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Hello again distributed logs&#39;</span><span class="p">);</span>
</code></pre></div>
<h2>Transports</h2>

<p>The default logger&#39;s has a default transport type of  <em>winston.transports.Console</em>, automatically outputs to console.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno">1</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">);</span>
<span class="lineno">2</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;This goes to nowhere!&#39;</span><span class="p">);</span>
<span class="lineno">3</span> 
<span class="lineno">4</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="p">{</span> <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;mylogfile.log&#39;</span> <span class="p">});</span>
<span class="lineno">5</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;To the file!&#39;</span><span class="p">);</span>
<span class="lineno">6</span> 
<span class="lineno">7</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">);</span>
<span class="lineno">8</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Both to file and console&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Winston have a lot of <a href="https://github.com/winstonjs/winston/blob/master/docs/transports.md#winston-transports">official transports</a> like <em>HTTP, redis, mongo</em> etc. Also 3rd party <a href="https://github.com/winstonjs/winston/blob/master/docs/transports.md#find-more-transports">options</a> are exist.</p>

<h2>Metadata</h2>

<p>You can add various data to logs:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno">1</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;test mesajı&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">bilgi</span><span class="o">:</span> <span class="s1">&#39;bu bir metadatadır&#39;</span> <span class="p">});</span>
</code></pre></div>
<h2>Interpolation</h2>

<p>Helps to write parametrized logs. Parameter types are: <code>%s string, %d number, %j json</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno">1</span> <span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">);</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;test message %s %d %j&#39;</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">{</span><span class="nx">number</span><span class="o">:</span> <span class="mi">123</span><span class="p">},</span> <span class="p">{</span><span class="nx">meta</span><span class="o">:</span> <span class="s2">&quot;this is meta&quot;</span> <span class="p">},</span> <span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">transport</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">meta</span><span class="p">){</span>
<span class="lineno">4</span>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;logged&quot;</span><span class="p">);</span>
<span class="lineno">5</span>     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">&quot;transport -&gt; %s, level -&gt; %s, message -&gt; %s, meta -&gt; %j&quot;</span><span class="p">,</span> <span class="nx">transport</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">meta</span><span class="p">));</span>
<span class="lineno">6</span> <span class="p">});</span>
</code></pre></div>
<h2>Exceptions</h2>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno"> 1</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">handleExceptions</span><span class="p">();</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="c1">// you can write unhandled exceptions to a special file if you want</span>
<span class="lineno"> 4</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">handleExceptions</span><span class="p">(</span><span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">File</span><span class="p">({</span> <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;path/to/exceptions.log&#39;</span> <span class="p">}))</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="c1">// or you can specify handleExceptions option while adding a transport</span>
<span class="lineno"> 7</span> <span class="c1">// humanReadableUnhandledException means it outputs readable stack trace</span>
<span class="lineno"> 8</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="p">{</span>
<span class="lineno"> 9</span>   <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;path/to/all-logs.log&#39;</span><span class="p">,</span>
<span class="lineno">10</span>   <span class="nx">handleExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">11</span>   <span class="nx">level</span><span class="o">:</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span>
<span class="lineno">12</span>   <span class="nx">humanReadableUnhandledException</span><span class="o">:</span> <span class="kc">true</span>
<span class="lineno">13</span> <span class="p">});</span>
<span class="lineno">14</span> 
<span class="lineno">15</span> <span class="c1">// prevent exiting from application after exception occurred:</span>
<span class="lineno">16</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">exitOnError</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</code></pre></div>
<p>On above code, transport level specified as <code>warn</code>. This means <code>warn</code> and <strong>above it</strong> (important level) will ve logs which are <code>warn</code>, <code>debug</code> and <code>error</code>. Less important levels will not be logged: <code>silly</code> and <code>verbose</code>.</p>

<h1>Demo</h1>

<p>I&#39;m determined to continue with our beloved repository <strong>chatcat</strong> :). Spoiler lovers can get codes of this chapter with:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> git clone https://github.com/dhalsim/chatcat.git
<span class="lineno">2</span> cd chatchat
<span class="lineno">3</span> git checkout alti
</code></pre></div>
<p>or you can go with the tutorial by <code>git checkout bes</code> and do the necessary changes yourself.</p>

<blockquote>
<p>Note: I&#39;m gonna use new advanced options and topics: colorize, zipping for File, tailing ve logging to Redis DB</p>
</blockquote>

<p><strong>src/lib/logging.js:</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">winston</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;winston&#39;</span><span class="p">);</span>
<span class="lineno"> 2</span> <span class="kd">var</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">);</span>
<span class="lineno"> 3</span> <span class="kd">var</span> <span class="nx">redis_config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;src/config&#39;</span><span class="p">).</span><span class="nx">redis</span><span class="p">;</span>
<span class="lineno"> 4</span> <span class="kd">var</span> <span class="nx">extend</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;src/lib/utils&#39;</span><span class="p">).</span><span class="nx">extend</span><span class="p">;</span>
<span class="lineno"> 5</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;winston-redis&#39;</span><span class="p">).</span><span class="nx">Redis</span><span class="p">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="kd">var</span> <span class="nx">redisClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;src/lib/redisAdapters/redisConnection&#39;</span><span class="p">).</span><span class="nx">getClient</span><span class="p">();</span>
<span class="lineno"> 8</span> <span class="kd">var</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">);</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="kd">var</span> <span class="nx">errorMeta</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">11</span>   <span class="nx">hostname</span><span class="o">:</span> <span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">(),</span>
<span class="lineno">12</span>   <span class="nx">pid</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span><span class="p">,</span>
<span class="lineno">13</span>   <span class="nx">memory</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">memoryUsage</span><span class="p">(),</span>
<span class="lineno">14</span>   <span class="nx">uptime</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">uptime</span><span class="p">(),</span>
<span class="lineno">15</span>   <span class="nx">env</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">||</span> <span class="s1">&#39;development&#39;</span>
<span class="lineno">16</span> <span class="p">};</span>
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="kd">var</span> <span class="nx">redisTransport</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Redis</span><span class="p">)({</span>
<span class="lineno">19</span>   <span class="nx">redis</span><span class="o">:</span> <span class="nx">redisClient</span>
<span class="lineno">20</span> <span class="p">});</span>
<span class="lineno">21</span> 
<span class="lineno">22</span> <span class="kd">var</span> <span class="nx">errorFileTransport</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">File</span><span class="p">)({</span>
<span class="lineno">23</span>   <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;./logs/errors.log&#39;</span><span class="p">,</span>
<span class="lineno">24</span>   <span class="nx">level</span><span class="o">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
<span class="lineno">25</span>   <span class="nx">colorize</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">26</span>   <span class="nx">timestamp</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="lineno">27</span>     <span class="k">return</span> <span class="nx">moment</span><span class="p">.</span><span class="nx">utc</span><span class="p">().</span><span class="nx">format</span><span class="p">();</span>
<span class="lineno">28</span>   <span class="p">},</span>
<span class="lineno">29</span>   <span class="nx">maxsize</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="c1">// 10 KB</span>
<span class="lineno">30</span>   <span class="nx">maxFiles</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="lineno">31</span>   <span class="c1">//formatter: function () {},</span>
<span class="lineno">32</span>   <span class="nx">tailable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">33</span>   <span class="nx">zippedArchive</span><span class="o">:</span> <span class="kc">true</span>
<span class="lineno">34</span> <span class="p">});</span>
<span class="lineno">35</span> 
<span class="lineno">36</span> <span class="c1">// error: 0, warn: 1, info: 2, verbose: 3, debug: 4, silly: 5</span>
<span class="lineno">37</span> 
<span class="lineno">38</span> <span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">Logger</span><span class="p">)({</span>
<span class="lineno">39</span>   <span class="nx">transports</span><span class="o">:</span> <span class="p">[</span>
<span class="lineno">40</span>     <span class="k">new</span> <span class="p">(</span><span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">)({</span>
<span class="lineno">41</span>       <span class="nx">level</span><span class="o">:</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
<span class="lineno">42</span>       <span class="nx">colorize</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">43</span>       <span class="nx">timestamp</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="lineno">44</span>         <span class="k">return</span> <span class="nx">moment</span><span class="p">.</span><span class="nx">utc</span><span class="p">().</span><span class="nx">format</span><span class="p">();</span>
<span class="lineno">45</span>       <span class="p">},</span>
<span class="lineno">46</span>       <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">47</span>       <span class="nx">prettyPrint</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">48</span>       <span class="nx">humanReadableUnhandledException</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">49</span>     <span class="p">}),</span>
<span class="lineno">50</span>     <span class="nx">errorFileTransport</span><span class="p">,</span>
<span class="lineno">51</span>     <span class="nx">redisTransport</span>
<span class="lineno">52</span>   <span class="p">]</span>
<span class="lineno">53</span> <span class="p">});</span>
<span class="lineno">54</span> 
<span class="lineno">55</span> <span class="c1">// I override logger function</span>
<span class="lineno">56</span> <span class="c1">// in case of error I&#39;ll inject errorMeta to meta</span>
<span class="lineno">57</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno">58</span>   <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
<span class="lineno">59</span>   <span class="kd">var</span> <span class="nx">level</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="lineno">60</span> 
<span class="lineno">61</span>   <span class="k">if</span><span class="p">(</span><span class="nx">level</span> <span class="o">===</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">62</span>     <span class="kd">var</span> <span class="nx">originalMeta</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="p">{};</span>
<span class="lineno">63</span>     <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">originalMeta</span><span class="p">,</span> <span class="nx">errorMeta</span><span class="p">);</span>
<span class="lineno">64</span>   <span class="p">}</span>
<span class="lineno">65</span> 
<span class="lineno">66</span>   <span class="nx">winston</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
<span class="lineno">67</span> <span class="p">};</span>
<span class="lineno">68</span> 
<span class="lineno">69</span> <span class="c1">// logger hatası</span>
<span class="lineno">70</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">71</span>   <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error occurred&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
<span class="lineno">72</span> <span class="p">});</span>
<span class="lineno">73</span> 
<span class="lineno">74</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">logger</span><span class="p">;</span>
<span class="lineno">75</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">loggerMiddleware</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">76</span>   <span class="nx">req</span><span class="p">.</span><span class="nx">logger</span> <span class="o">=</span> <span class="nx">logger</span><span class="p">;</span>
<span class="lineno">77</span>   <span class="nx">next</span><span class="p">();</span>
<span class="lineno">78</span> <span class="p">};</span>
<span class="lineno">79</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">exceptionMiddleware</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">80</span>   <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="p">{</span> <span class="nx">stack</span><span class="o">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span> <span class="p">});</span>
<span class="lineno">81</span>   <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="lineno">82</span> <span class="p">};</span>
<span class="lineno">83</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">logAndCrash</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">84</span>   <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="p">{</span> <span class="nx">stack</span><span class="o">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span> <span class="p">});</span>
<span class="lineno">85</span>   <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
<span class="lineno">86</span> <span class="p">}</span>
</code></pre></div>
<p>There are 3 exported functions here. <code>logger</code> is for general purpose in case of I need. I&#39;ll use <code>loggerMiddleware</code> in express and use it to add logger to <em>req</em> object. <code>exceptionMiddleware</code> is for exception management. This middleware will work when <code>next(error)</code> called.</p>

<p><code>logAndCrash</code> function is a special one for using from <strong>process.uncaughtException</strong>. As you noticed, I <strong>re-throw</strong> the exception caught and this leads node process to exit. I&#39;ll be back on this later.</p>

<p>In case of an error, by <em>overriding</em> <code>log</code> function of logger, I add <code>errorMeta</code> as a useful meta.</p>

<p>Console transport for general purpose and File and Redis transports for error cases used. You can see a <em>list</em> called <code>winston</code> after log occurs on redis.</p>

<p>Now we will change a function in redisAdapter. If it couldn&#39;t find the wanted room, we will throw an <strong>Error</strong> object.</p>

<blockquote>
<p>Note: Use <strong>promises</strong> to get <em>asynchronous</em> errors easily.</p>
</blockquote>

<p><strong>redisAdapter.js:</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno"> 1</span> <span class="p">...</span>
<span class="lineno"> 2</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">getRoomById</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">roomId</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">ROOMS</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">roomId</span><span class="p">;</span>
<span class="lineno"> 4</span>   <span class="k">return</span> <span class="nx">hgetall</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 5</span>     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 6</span>       <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Room id not found:&#39;</span> <span class="o">+</span> <span class="nx">roomId</span><span class="p">);</span>
<span class="lineno"> 7</span>     <span class="p">}</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>     <span class="k">return</span> <span class="nx">unflatten</span><span class="p">(</span><span class="nx">room</span><span class="p">);</span>
<span class="lineno">10</span>   <span class="p">});</span>
<span class="lineno">11</span> <span class="p">};</span>
<span class="lineno">12</span> <span class="p">...</span>
</code></pre></div>
<p><br /></p>

<p>Here we catch exceptions with <strong>catch</strong> (clearly!) and send it to exception handler middleware with <code>next(..)</code>.</p>

<p><strong>routes/index.js:</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno"> 1</span> <span class="p">...</span>
<span class="lineno"> 2</span> <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/room/:id&#39;</span><span class="p">,</span> <span class="nx">securePage</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">roomId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="lineno"> 4</span>   <span class="nx">roomAdapter</span><span class="p">.</span><span class="nx">getRoomById</span><span class="p">(</span><span class="nx">roomId</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 5</span>     <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">room</span> <span class="o">=</span> <span class="nx">room</span><span class="p">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>     <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="lineno"> 8</span>       <span class="nx">user</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">),</span>
<span class="lineno"> 9</span>       <span class="nx">room</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">room</span><span class="p">),</span>
<span class="lineno">10</span>       <span class="nx">socket_host</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">socket_host</span>
<span class="lineno">11</span>     <span class="p">});</span>
<span class="lineno">12</span>   <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">13</span>     <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="lineno">14</span>   <span class="p">}).</span><span class="nx">done</span><span class="p">();</span>
<span class="lineno">15</span> <span class="p">});</span>
<span class="lineno">16</span> <span class="p">...</span>
</code></pre></div>
<blockquote>
<p><strong>From express documentation:</strong> &quot;If the current middleware does not end the request-response cycle, it must call next() to pass control to the next middleware, otherwise the request will be left hanging.&quot;</p>
</blockquote>

<p><strong>app.js:</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="lineno">1</span> <span class="p">...</span>
<span class="lineno">2</span> <span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;src/lib/logging&#39;</span><span class="p">);</span>
<span class="lineno">3</span> <span class="p">...</span>
<span class="lineno">4</span> <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">.</span><span class="nx">loggerMiddleware</span><span class="p">);</span>
<span class="lineno">5</span> <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">.</span><span class="nx">exceptionMiddleware</span><span class="p">);</span>
<span class="lineno">6</span> <span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;uncaughtException&#39;</span><span class="p">,</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">logAndCrash</span><span class="p">);</span>
<span class="lineno">7</span> <span class="p">...</span>
</code></pre></div>
<blockquote>
<p>Let&#39;s look at <strong>logAndCrash</strong> now. We talked about node.js <em>single threaded</em> logic before. And with its async structure, it differs from languages/platforms like <em>ASP.NET</em> or <em>Java</em> as we can redirect a user to an error page in case of an error (like used with Application_Error on ASP.NET). We need to exit from node when we have an unhandled exception.</p>

<p>The best option to take is unfortunately let the program crash. On web applications like <em>ASP.NET</em>, every request works on a seperate thread thus lets rest of the process go on without restarting. But it&#39;s not the case with node.js</p>

<p>For this and other reasons (unhandled errors may broke reliability of the app), we let process to exit. To restart the application afterwards we can use solutions like <a href="https://www.npmjs.com/package/forever">Forever</a> and <a href="http://pm2.keymetrics.io/">PM2</a>.</p>

<p>Sources:</p>

<ul>
<li><a href="https://www.joyent.com/developers/node/design/errors">https://www.joyent.com/developers/node/design/errors</a></li>
<li><a href="http://stackoverflow.com/a/15874115">http://stackoverflow.com/a/15874115</a></li>
<li><a href="https://nodejs.org/api/process.html#process_event_uncaughtexception">https://nodejs.org/api/process.html#process_event_uncaughtexception</a></li>
</ul>
</blockquote>

<h1>Result</h1>

<p>We proceed pretty much on error management and logging. Next article will be about logging in scaled systems. I&#39;ll write about how we log and gather these scaled node.js applications.</p>

<div class="seriesNote">
  This article is <strong>part 2</strong> of a <strong>2-part</strong> series called <strong>I Have Control</strong></p>
    <ul>
    
    
    
        

    
    
        <li class="">Part 1 -
        
            <a href="/en/node.js/i-have-control/2015/11/13/debugging-nodejs">
        
    Debugging Node.js
    
      </a>
    
        </li>
    
    
    
        

    
    
        <li class="selected">Part 2 -
        
    Node.js Error Management and Logging
    
        </li>
    
    
    
    
    
    
    
    
    </ul>
</div>

<p><br /></p>

					<div class="meta">
						<p class="date-publish">
							Published:
							<date class="date-pub" title="2015-11-13T00:00:00+02:00" datetime="2015-11-13T00:00:00+02:00" pubdate>
							<span class="month"><abbr>November</abbr></span>
							<span class="day">13</span>
							<span class="year">2015</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
    
    	<li><a href="/en/categories.html#_i18n-ref">
    		_i18n <span>5</span>
    	</a></li>
    
    	<li><a href="/en/categories.html#en-ref">
    		en <span>5</span>
    	</a></li>
    
    	<li><a href="/en/categories.html#node.js-ref">
    		node.js <span>2</span>
    	</a></li>
    
    	<li><a href="/en/categories.html#i-have-control-ref">
    		i-have-control <span>2</span>
    	</a></li>
    
  



						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
    
    	<li><a href="/en/tags.html#node.js-ref">node.js <span>2</span></a></li>
    
    	<li><a href="/en/tags.html#logging-ref">logging <span>1</span></a></li>
    
    	<li><a href="/en/tags.html#error-ref">error <span>1</span></a></li>
    
    	<li><a href="/en/tags.html#bugs-ref">bugs <span>1</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="mustapha_alaziz" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/mustapha_alaziz" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					<div class="comment">
					


  <div id="disqus_thread"></div>
<script type="text/javascript">
    

    
    var disqus_shortname = 'dhalsimblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/node.js/i-have-control/2015/11/13/debugging-nodejs" title="View Debugging Node.js">&laquo; Debugging Node.js</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/virtual-machines/2015/11/14/vagrant" title="View Vagrant">Vagrant &raquo;</a></li>
							
						</ul>
					</nav>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>About Me</h4>
					<img src="/assets/me_rounded.png" style="width: 150px" />
					<ul>
						<li class="contact"><span class="author fn n">Barış Aydek</span></li>
						<li class="contact"><address><span class="fn email"><a href="mailto:baris.aydek@gmail.com">baris.aydek@gmail.com</a></span></address></li>
						<li class="github"><a href="http://github.com/dhalsim/" rel="me">github.com/dhalsim</a></li>
						<li class="twitter"><a href="http://twitter.com/mustapha_alaziz/" rel="me">twitter.com/mustapha_alaziz</a></li>
						<li class="linkedin"><a href="https://www.linkedin.com/in/baris-aydek-39352325" rel="me">linkedin.com</a></li>
					</ul>
				</div><!-- misc -->
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/node.js/i-have-control/2015/11/13/nodejs-error-management-and-logging" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" charset="utf-8"></script>
<script type="text/javascript">
$(document).ready(function(){
	// browser window scroll (in pixels) after which the "back to top" link is shown
	var offset = 300,
	//browser window scroll (in pixels) after which the "back to top" link opacity is reduced
	offset_opacity = 1200,
	//duration of the top scrolling animation (in ms)
	scroll_top_duration = 700,
	//grab the "back to top" link
	$back_to_top = $('.cd-top');

	//hide or show the "back to top" link
	$(window).scroll(function(){
		( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
		if( $(this).scrollTop() > offset_opacity ) {
			$back_to_top.addClass('cd-fade-out');
		}
	});

	//smooth scroll to top
	$back_to_top.on('click', function(event){
		event.preventDefault();
		$('body,html').animate({
			scrollTop: 0 ,
		 	}, scroll_top_duration
		);
	});
});
</script>


<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js" charset="utf-8"></script>
<script type="text/javascript">
	$(document).ready(function () {
		anchors.add('.content h1');
		anchors.add('.content h2');
		anchors.add('.content h3');
		anchors.add('.content h4');
		anchors.add('.content h5');

		var level = 1;
		var $parentUl = $currentUl = $('<ul/>');
		var count = 0;
		var listTypes = ['decimal', 'lower-alpha', 'circle']
		$('.anchorjs-link').each(function () {
			count++;
			if(count === 1)
			{
				return true;
			}

			var $this = $(this);
			var $parent = $this.parent();
			var tagName = $parent.prop("tagName");
			var thisLevel = tagName.charAt(1);
			var text = $parent.text();

			if(thisLevel > level) {
				var $newUl = $('<ul/>');
				$currentUl.append($newUl);
				$currentUl = $newUl;
			} else if(thisLevel < level) {
				var diff = level - thisLevel;
				$currentUl = $currentUl.parents().eq(diff-1);
			}

			var $a = $('<a/>');
			$a.text(text);
			$a.attr('href', $this.attr('href'));

			level = thisLevel;
			$currentUl.css('list-style', listTypes[level - 1]);
			$currentUl.append($('<li/>').append($a));
		});

		$('.content header').append(
			$('.toc').html(
				$('<h4/>', {text: 'Table of contents: '})
			).append($parentUl)
		);

		$('.content img')
			.attr('title', 'Resmi büyütmek için üstüne tıklayınız.')
			.click(function (e) {
				var img = $('<img/>', {src: this.src});
				return $.fancybox(img);
			});
	});
</script>


  





  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-70097547-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




</body>
</html>

