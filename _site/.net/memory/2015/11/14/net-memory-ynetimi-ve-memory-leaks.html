

<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="tr"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>.Net Memory Yönetimi ve Memory Leaks</title>
	<meta name="author" content="Barış Aydek">

	<!-- for Google -->
	<meta name="description" content="Bu yazıyı okuyarak .NET'in hafıza yönetiminde verimli uygulamalar yazabilmek için gerekli genel bilgileri öğrenibilirsiniz." />
	<meta name="keywords" content="" />

	<meta name="author" content="Barış Aydek" />
	<meta name="copyright" content="" />
	<meta name="application-name" content="Dhalsim's" />

	<!-- for Facebook -->
	<meta property="og:title" content=".Net Memory Yönetimi ve Memory Leaks" />
	<meta property="og:type" content="article" />
	<meta property="og:image" content="http://dhalsim.github.io/assets/images/net_framework.png" />
	<meta property="og:url" content="http://dhalsim.github.io/.net/memory/2015/11/14/net-memory-ynetimi-ve-memory-leaks" />
	<meta property="og:description" content="Bu yazıyı okuyarak .NET'in hafıza yönetiminde verimli uygulamalar yazabilmek için gerekli genel bilgileri öğrenibilirsiniz." />

	<!-- for Twitter -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content=".Net Memory Yönetimi ve Memory Leaks" />
	<meta name="twitter:description" content="Bu yazıyı okuyarak .NET'in hafıza yönetiminde verimli uygulamalar yazabilmek için gerekli genel bilgileri öğrenibilirsiniz." />
	<meta name="twitter:image" content="http://dhalsim.github.io/assets/images/net_framework.png" />
	<meta name="twitter:creator" content="@mustapha_alaziz">

  <style>
	  @font-face {
			font-family: 'Allerta';
			src: url('/assets/fonts/Allerta-Regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/Allerta-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/Allerta-Regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/Allerta-Regular.woff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/Allerta-Regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/Allerta-Regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}
		@font-face {
			font-family: 'Punk';
			src: url('/assets/fonts/punk-regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/punk-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/punk-regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/punk-regularwoff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/punk-regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/punk-regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}

		@font-face {
			font-family: 'Ewert';
			src: url('/assets/fonts/Ewert-Regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/Ewert-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/Ewert-Regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/Ewert-Regularwoff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/Ewert-Regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/Ewert-Regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}
	</style>
	<link href='/assets/themes/the-program/css/style.css' rel="stylesheet" media="all">
	<link href='/assets/css/mystyles.css' rel="stylesheet" media="all">
	<link href='/assets/css/flags/flags.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title=".Net Memory Yönetimi ve Memory Leaks" type="application/atom+xml">
	<style media="screen">
	.cd-top {
	  display: inline-block;
	  height: 40px;
	  width: 40px;
	  position: fixed;
	  bottom: 100px;
	  right: 10px;
	  z-index: 10;
	  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	  /* image replacement properties */
	  overflow: hidden;
	  text-indent: 100%;
	  white-space: nowrap;
	  background: rgba(232, 98, 86, 0.8) url(/assets/images/cd-top-arrow.svg) no-repeat center 50%;
	  visibility: hidden;
	  opacity: 0;
	  -webkit-transition: opacity .3s 0s, visibility 0s .3s;
	  -moz-transition: opacity .3s 0s, visibility 0s .3s;
	  transition: opacity .3s 0s, visibility 0s .3s;
	}
	.cd-top.cd-is-visible, .cd-top.cd-fade-out, .no-touch .cd-top:hover {
	  -webkit-transition: opacity .3s 0s, visibility 0s 0s;
	  -moz-transition: opacity .3s 0s, visibility 0s 0s;
	  transition: opacity .3s 0s, visibility 0s 0s;
	}
	.cd-top.cd-is-visible {
	  /* the button becomes visible */
	  visibility: visible;
	  opacity: 1;
	}
	.cd-top.cd-fade-out {
	  /* if the user keeps scrolling down, the button is out of focus and becomes less visible */
	  opacity: .5;
	}
	.no-touch .cd-top:hover {
	  background-color: #e86256;
	  opacity: 1;
	}
	@media only screen and (min-width: 768px) {
	  .cd-top {
	    right: 20px;
	    bottom: 20px;
	  }
	}
	@media only screen and (min-width: 1024px) {
	  .cd-top {
	    height: 60px;
	    width: 60px;
	    right: 30px;
	    bottom: 30px;
	  }
	}
	</style>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" charset="utf-8">
	
</head>
<body>
<a href="#0" class="cd-top cd-is-visible">Top</a>
<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
					<ul>
						<li class="logo" style="height: 249px;">
							<a href="">
								<img src="/assets/dhalsim_logo.gif" />
							</a>
						</li>
						<li class="logo">
							<a href="/">
								Dhalsim's
							</a>
						</li>
						<li class="archive"><a href="/archive.html">Arşiv</a></li>
						<li class="page"><a href="/pages.html">Sayfalar</a></li>
						<li class="category"><a href="/categories.html">Kategoriler</a></li>
						<li class="tag"><a href="/tags.html">Taglar</a></li>
					</ul>

					<hr />
					<nav class="languageSelector">
						
							<a href="/en" ><img src="/assets/blank.gif" class="flag flag-gb" alt="İngilizce" /> </a><a href="/en" class="alink">İngilizce</a>
						
						-
						
							<img src="/assets/blank.gif" class="flag flag-tr" alt="Türkçe" /> Türkçe
						
					</nav>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					

<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">.Net Memory Yönetimi ve Memory Leaks</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
				<div class="toc">
					<span>İçindekiler tablosu yükleniyor...</span>
					<div class="sp-circle"></div>
				</div>
			</header>

			<div class="bd">
				<div class="entry-content">
					<h1>Genel Terimler</h1>

<h2>Heap</h2>

<ul>
<li>Code Heap</li>
<li>Small Object Heap</li>
<li>Large Object Heap</li>
<li>Process Heap</li>
</ul>

<h2>Stack</h2>

<p>Metot çağrımları sırasında o metot için geçerli verilerin tutulması, ve gerektiğinde hatırlanması amacıyla kullanılan memory&#39;dir.</p>

<p>En son çağrılan, en üstteki memory frame olduğundan stack yapısındadır.</p>

<h2>Value Types</h2>

<ul>
<li>Byte</li>
<li>Int32</li>
<li>UInt32</li>
<li>Double</li>
<li>Decimal</li>
<li><strong>Structs</strong></li>
<li>SByte</li>
<li>Int64</li>
<li>UInt64</li>
<li>Boolean</li>
<li>IntPtr</li>
<li>Int16</li>
<li>UInt16</li>
<li>Single</li>
<li>Char</li>
<li>UIntPtr</li>
</ul>

<h2>Reference Types</h2>

<ul>
<li>classes</li>
<li>interfaces</li>
<li>delegates</li>
<li>strings</li>
<li>instances of “object”</li>
</ul>

<h3>Örnek</h3>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno">1</span>  <span class="k">void</span> <span class="nf">Method1</span><span class="p">()</span>
<span class="lineno">2</span>  <span class="p">{</span>
<span class="lineno">3</span>        <span class="n">MyClass</span> <span class="n">myObj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="p">();</span>
<span class="lineno">4</span>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">myObj</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
<span class="lineno">5</span>  <span class="p">}</span>
</code></pre></div>
<p><img src="https://www.safaribooksonline.com/library/view/under-the-hood/9781906434755/images/20.jpg" alt="sekil1"></p>

<p>When Method1 completes, the stack frame is removed (along with the object reference), leaving the object without a reference.</p>

<h1>İşleyiş</h1>

<h2>Passing parameters</h2>

<ul>
<li>Value Type parametre olarak geçilirken kopyalanır</li>
<li>Reference Type parametre olarak geçilirken referans üzerinden geçer</li>
</ul>

<blockquote>
<p>struct&#39;lar value type olduğundan ve programcı tarafından tanımlandığından boyut olarak büyük olabilir. Bu da bazı performans sorunlarına yol açabilir</p>
</blockquote>

<h2>Ref kullanımı</h2>

<h3>Örnek 2</h3>

<p>Aşağıdaki örneğe dikkat edilirse</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno"> 1</span>  <span class="k">void</span> <span class="nf">Method1</span><span class="p">()</span>
<span class="lineno"> 2</span>  <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="kt">int</span> <span class="n">v1</span><span class="p">=</span><span class="m">22</span><span class="p">;</span>
<span class="lineno"> 4</span>     <span class="n">Method2</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span>
<span class="lineno"> 5</span>     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Method1</span> <span class="p">=</span> <span class="err">”</span> <span class="p">+</span> <span class="n">v1</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="lineno"> 6</span>  <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>  <span class="k">void</span> <span class="nf">Method2</span><span class="p">(</span><span class="kt">int</span> <span class="n">v2</span><span class="p">)</span>
<span class="lineno"> 9</span>  <span class="p">{</span>
<span class="lineno">10</span>     <span class="n">v2</span><span class="p">=</span><span class="m">12</span><span class="p">;</span>
<span class="lineno">11</span>     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Method2</span> <span class="p">=</span> <span class="err">”</span> <span class="p">+</span> <span class="n">v2</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="lineno">12</span>  <span class="p">}</span>
</code></pre></div>
<p>Sonuç:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span>  Method 2 = 12
<span class="lineno">2</span>  Method 1 = 22
</code></pre></div>
<p>Parametreleri ref keyword&#39;ü ile geçirdiğimizde</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno"> 1</span>  <span class="k">void</span> <span class="nf">Method1</span><span class="p">()</span>
<span class="lineno"> 2</span>  <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="kt">int</span> <span class="n">v1</span><span class="p">=</span><span class="m">22</span><span class="p">;</span>
<span class="lineno"> 4</span>     <span class="n">Method2</span><span class="p">(</span><span class="k">ref</span> <span class="n">v1</span><span class="p">);</span>
<span class="lineno"> 5</span>     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Method1</span> <span class="p">=</span> <span class="err">”</span> <span class="p">+</span> <span class="n">v1</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="lineno"> 6</span>  <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>  <span class="k">void</span> <span class="nf">Method2</span><span class="p">(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">v2</span><span class="p">)</span>
<span class="lineno"> 9</span>  <span class="p">{</span>
<span class="lineno">10</span>     <span class="n">v2</span><span class="p">=</span><span class="m">12</span><span class="p">;</span>
<span class="lineno">11</span>     <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">“</span><span class="n">Method2</span> <span class="p">=</span> <span class="err">”</span> <span class="p">+</span> <span class="n">v2</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="lineno">12</span>  <span class="p">}</span>
</code></pre></div>
<p>Sonuç şu şekilde olacaktır:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span>  Method 2 = 12
<span class="lineno">2</span>  Method 1 = 12
</code></pre></div>
<h2>Boxing Unboxing</h2>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno">1</span>   <span class="c1">// integer Stack&#39;te yaratıldı</span>
<span class="lineno">2</span>   <span class="kt">int</span> <span class="n">stackVariable</span><span class="p">=</span><span class="m">12</span><span class="p">;</span>
<span class="lineno">3</span>   <span class="c1">// integer Heap&#39;te yaratıldı = Boxing</span>
<span class="lineno">4</span>   <span class="kt">object</span> <span class="n">boxedObject</span><span class="p">=</span> <span class="n">stackVariable</span>
<span class="lineno">5</span>   <span class="c1">// Unboxing</span>
<span class="lineno">6</span>   <span class="kt">int</span> <span class="n">unBoxed</span><span class="p">=(</span><span class="kt">int</span><span class="p">)</span><span class="n">boxedObject</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p>object tipinde parametre alan bir metoda geçilen değer otomatik boxing işlemine uğrar ve bu işlem bilinçsiz olarak loop içinde yapılıyorsa performans problemine yol açabilir</p>
</blockquote>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno">1</span>   <span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">12</span><span class="p">;</span>
<span class="lineno">2</span>   <span class="n">ArrayList</span> <span class="n">lst</span><span class="p">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="p">();</span>
<span class="lineno">3</span>   <span class="c1">// ArrayList Add metodunun imzası</span>
<span class="lineno">4</span>   <span class="c1">// int Add(object value)          </span>
<span class="lineno">5</span>   <span class="n">lst</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="c1">// otomatik Boxing</span>
<span class="lineno">6</span>   <span class="kt">int</span> <span class="n">p</span><span class="p">=(</span><span class="kt">int</span><span class="p">)</span><span class="n">lst</span><span class="p">[</span><span class="m">0</span><span class="p">];</span> <span class="c1">// Unboxing</span>
</code></pre></div>
<h1>Garbage collection</h1>

<p>Heap üzerinde objelerin referans edilip edilmediğine bakıp heap&#39;i temizler. Baktığı yerler:</p>

<ul>
<li>global/static object references</li>
<li>CPU registers</li>
<li>object finalization references</li>
<li>Interop references (COM/API çağrımlarına geçen .NET objeleri)</li>
<li>stack references</li>
</ul>

<h2>Yöntemler</h2>

<ul>
<li>SOH Cleanup (heap compaction)</li>
<li>LOH Sweeping (free space tracking)</li>
</ul>

<p>Small Object Heap&#39;te nesneler memory&#39;de ardışık olarak tutulur ve GC bu alanı temizlik sırasında ardışık tutar. Taşıma işlemleri sayesinde boş kısımlar minimumdadır ancak bu işlem CPU zamanı kullandığı için performansı etkileyebilir.</p>

<p>Large Object Heap&#39;te taşıma işlemi uzun süreceğinden ardışıl değildir. Boş ve kullanılan kısımlar takip edilir. Memory&#39;nin bir bölümü boş olarak işaretlendiğinde yerine en uygun nesnenin tahsil edilmesi gerekir. Bu yüzden memory alanı verimsiz kullanılabilir.</p>

<ul>
<li>Statik Objeler</li>
</ul>

<p>Bir class member static olarak tanımlıysa, bu onu instance bazında değil class bazında bir obje haline getirir. Genellikle global değişken tanımlamak amacıyla kullanılır. Bir appdomain içindeki tüm threadler tarafından erişilebilirler. Appdomain&#39;in yaşam zamanı boyunca memory&#39;de tutulurlar.</p>

<blockquote>
<p><em>[ThreadStatic]</em> attribute&#39;u ile tanımlı member&#39;lar thread başına bir instance olarak tutulurlar.</p>
</blockquote>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span>  [ThreadStatic]
<span class="lineno">2</span>  public static int NumberofThreadHits=0;
</code></pre></div>
<h3>Örnek</h3>

<ul>
<li>Önce</li>
</ul>

<p><img src="https://www.safaribooksonline.com/library/view/under-the-hood/9781906434755/images/41-1.jpg" alt=""></p>

<ul>
<li>Sonra</li>
</ul>

<p><img src="https://www.safaribooksonline.com/library/view/under-the-hood/9781906434755/images/42-1.jpg" alt=""></p>

<h2>GC Ne zaman Çalışır?</h2>

<p>Belli memory koşulları oluştuğunda veya uygulama hafıza sıkıntısı çekmeye başladığında ayrı bir thread&#39;de çalışır. Ancak GC bir nesnenin yaşamasına izin vermesi için en az bir root referansa ihtiyacı vardır.</p>

<p>Developer GC&#39;yi şu yöntemle çalışmaya zorlayabilir:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> GC.Collect();
</code></pre></div>
<p>Ancak bu kullanım performans ve scalibility sorunlarına yol açabilir. Kullanılması tavsiye edilmiyor.</p>

<h2>Objelerin sınıflandırılması</h2>

<p>GC yöntemlerine bakıldığında -özellikle büyük nesnelerde- kullanım listeleri tutma ve hafızayı compact tutma işlemlerinin problemli olduğu görülür. Büyük obje graflarında gezmek, ölü nesnelerin üzerine kullanımdakileri kopyalamak önemli işlemci zamanı gerektirektirir. Bu yüzden tüm bu işlemlerin optimize olması gerekmektedir.</p>

<p>Bu yüzden GC&#39;yi tasarlayanlari tüm objeleri 3 gruba sınıflandırdılar: kısa süre içinde allocate olup silinen <strong>short-lived</strong> objeler, öte taraftan erken allocate olup süresiz kullanılan <strong>long-lived</strong> objeler ve ikisinin ortasındali <strong>medium-lived</strong> objeler.</p>

<p>Genel allocation biçimleri incelendiğinde short-lived objelerin long-lived objelere göre daha sık kullanıldığını keşfettiler. Ayrıca GC tarafından sık toplanan objelerin de yakın zamanda allocate edilen objeler olduğunu gördüler. Çoğu obje bir metot içinde kullanılıp kapsam dışına çıktığından kısa sürelidirler. Bu yüzden kısa zaman içinde allocate olmuş nesneler GC tarafından daha sık kontrol edilir.</p>

<p>Bu tipler şu şekilde adlandırılmışlardır.</p>

<ul>
<li>Gen 0 (short-lived)</li>
<li>Gen 1 (medium-lived)</li>
<li>Gen 2 (long-lived)</li>
</ul>

<h3>Örnek</h3>

<p>Aşağıdaki şekilde SOH üzerinde her objeyi ve ait oldukları generation&#39;ı görebilirsiniz. Obje W en az 2 GC kontrolünden geçmiş, oysaki Z ve Y ilk defa bakılacak. Obje X bir GC kontrolünden hayatta kalmış geçmiş.</p>

<p><img src="https://www.safaribooksonline.com/library/view/under-the-hood/9781906434755/images/45-1.jpg" alt=""></p>

<h2>GC Ne zaman Çalışır? (2)</h2>

<p>Generation&#39;a özel boyutlar aşıldığında otomatik olarak çalışır</p>

<ul>
<li>Gen 0 ~256 K</li>
<li>Gen 1 ~ 2 MB (bu durumda GC Gen 1 ve Gen 0&#39;ı toplar)</li>
<li>Gen 2 ~10 MB (bu durumda GC Gen 2, 1 ve 0&#39;ı toplar)</li>
</ul>

<p>Ayrıca</p>

<ul>
<li>kod tarafında GC.Collect() çağrıldığında</li>
<li>işletim sistemi düşük hafıza bildirimi gönderdiğinde</li>
</ul>

<blockquote>
<p>bu değerler uygulamaya ve çalıştığı makineye göre değişiklik gösterebilir</p>

<p>genel çalışma prensibi olarak Gen 0 toplama Gen 1&#39;e göre ve Gen 1 toplama da Gen 2&#39;ye göre 10 kat daha sık çalışır.</p>
</blockquote>

<h3>Gen 0 collection</h3>

<ul>
<li>Eğer root&#39;u varsa Gen 1&#39;e taşı</li>
<li>Yoksa öldür ve sıkıştır</li>
</ul>

<p>Bu durumda Gen 0 toplama sonunda Gen 0 boş olacaktır.</p>

<h3>Gen 1 collection</h3>

<ul>
<li>Gen 1 ve 0 için işlem yapılır. Sonucunda nesne ya gen 0&#39;a taşınır ya da gen 2&#39;ye yükseltilir.</li>
</ul>

<h3>Gen 2 collection</h3>

<ul>
<li>Tüm generation&#39;lar denetlendiği için en uzun sürenidir.</li>
</ul>

<h3>Sonuç</h3>

<p>İdeal olarak objelerin çoğu Gen 0&#39;da belki Gen 1&#39;de ölecektir.</p>

<p>Gen 2&#39;ye gelen objeler belli nedenlerle orada olmalı; sürekli yaratılıp kullanmaktansa saklanması ve böylece tekrar kullanımı söz konusu olabilir.</p>

<p>Gen 2&#39;ye gelip root referansı kalmayan objeler hafızada bir süre gereksiz yer tutacaklardır. Root referansı devam eden ve sık çalışan Gen 2 kodu, Gen 2 toplamasının da sık çalışmasına neden olur.</p>

<blockquote>
<p>Bir objenin gereksiz yere referansının olması o objeyi çok kolay Gen 2&#39;ye terfi ettirebilir, bu da memory&#39;nin verimsiz kullanılmasını yol açabilir.</p>
</blockquote>

<h1>Finalization</h1>

<p>.NET tarafından kullanılan unmanaged (.NET olmayan) herhangi bir kod GC tarafından toplanamaz. Bu yüzden .NET tarafında bu kaynakların manuel free edilmesi gerekmektedir.</p>

<p>Bu yüzden .NET tarafındaki finalizer yapısı kullanılır. Ancak bu yapıyı kullanmanın bir yan etkisi olarak bu nesnelerinizin yaşam ömrünü uzatacaktır.</p>

<p>Nesnenizin yok edilmeden hemen önce .NET tarafından çağrılacak aşağıdaki yapılardan herhangi birini kullanabilirsiniz.</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">TestClass</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>       <span class="p">~</span><span class="n">TestClass</span><span class="p">()</span>
<span class="lineno"> 4</span>       <span class="p">{</span>
<span class="lineno"> 5</span>       <span class="p">}</span>
<span class="lineno"> 6</span> <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="k">class</span> <span class="nc">TestClass2</span>
<span class="lineno"> 9</span> <span class="p">{</span>
<span class="lineno">10</span>       <span class="k">void</span> <span class="nf">Finalize</span><span class="p">()</span>
<span class="lineno">11</span>       <span class="p">{</span>
<span class="lineno">12</span>       <span class="p">}</span>
<span class="lineno">13</span> <span class="p">}</span>
</code></pre></div>
<p>Ancak bu kaynakları free etme işlemi GC&#39;nin işleyişini yavaşlatacağından, asenkron olarak belli bir thread üzerinden bu yapıların queue mantığıyla çağrılması söz konusudur.</p>

<p><img src="https://www.safaribooksonline.com/library/view/under-the-hood/9781906434755/images/51-1.jpg" alt=""></p>

<p>Şekilde görüldüğü gibi Z nesnesinin finalizer metodu var. Bu da finalization queue (finalize edilecek nesnelerin listesi) denilen bir yapıya referansının eklenmesine yol açar.</p>

<p>Z nesnesi root referansını kaybettiğinde collection işlemi için aday olacakken, finalization queue&#39;da referansı olduğundan Gen 1 de olduğunu farzedersek Gen 2&#39;ye terfi edecektir.</p>

<p>Aynı zamanda fReachable denen artık finalizer&#39;ın çağrılması gereken objelerin tutulduğu queue&#39;ya aktarılır. Ancak bundan sonra başka bir thread bu queue&#39;yu okuyup nesnelerin Finalize metodunu ya da destructor&#39;ını çağırır.</p>

<p><img src="https://www.safaribooksonline.com/library/view/under-the-hood/9781906434755/images/52-1.jpg" alt=""></p>

<h3>Sonuç</h3>

<p>Bu yapıda Finalize&#39;ın işleyişi verimsiz gibi görünmekte ancak GC bize bu implemantasyonu, eksik yapılan bir temizlik yüzünden veya process&#39;in durması durumunda son çare olarak yapmamız için izin veriyor.</p>

<h2>Disose Finalize Pattern Örnek</h2>

<p><a href="https://dotnetfiddle.net/JQV78j">Disose Finalize Pattern Örnek</a></p>

<iframe width="100%" height=3150" src="https://dotnetfiddle.net/Widget/JQV78j" frameborder="0"></iframe>

<p>Yukarıdaki örnekte görüldüğü gibi GC&#39;nin bu asenkron yapısına uyacak aynı zamanda kendi isteğimizle de çalıştırabileceğimiz bir Finalize Dispose Pattern görebilirsiniz.</p>

<p>Bu patternde <strong>protected virtual void Dispose(Boolean)</strong> metodu iki farklı senaryo için uygulanmaktadır:</p>

<ul>
<li>disposing = true =&gt; metot kullanıcı kodundan çağrıldı, managed ve unmanaged kaynaklar dispose edilebilir.</li>
<li>disposing = false =&gt; methot runtime tarafından finalizer ile çağrıldı, sadece unmanaged kaynaklar dispose edilebilir.</li>
</ul>

<p><em>Base</em> class&#39;ta <em>IDisposable</em>&#39;dan gelen <strong>public void Dispose()</strong> metodunu, <strong>protected virtual void Dispose(Boolean)</strong> metodunu ve <strong>~Base()</strong> Finalize metodunu görebilirsiniz.</p>

<p>.NET&#39;te bu işlemin Base class&#39;larda da handle edilmesi gerektiğinden kodda böyle bir hiyerarşi kuruldu.</p>

<p><em>IDisposable</em> implementasyonunu kendi isteğimizle ,<strong>mesela using statement kullanarak</strong> çağırıyoruz. Ama bu çağrımı yapmayıp işi GC&#39;ye havale edeceksek bunu da Finalize (destructor) metodu üzerinden çalışmasını sağlıyoruz.</p>

<p>Her ikisinin de farklı threadlerde çalışmasından ve kestirilemez olmasından ötürü kodu <strong>protected virtual void Dispose(Boolean)</strong> metodu içinden ortaklaştırıyoruz.</p>

<blockquote>
<p>Eğer thread-safe olması gereken bir kaynak varsa bunu lock mekanizmalarıyla thread-safe hale getirmeliyiz.</p>
</blockquote>

<p><em>Derived</em> class&#39;ta ise eğer sadece o instance için handle edilmesi gereken unmanaged bir kaynak varsa dispose patternini uygulamamız gerekiyor. bunu da <strong>protected virtual void Dispose(Boolean)</strong> metodunu <strong>override</strong> ederek yapıyoruz.</p>

<blockquote>
<p>Dikkat etmemiz gereken nokta bu override edilmiş metotda base&#39;in Dispose(Boolean) metodunu en sonda çağırmaktır, böylece üst sınıfların da kendi dispose mekanizlarının çalışması için zinciri devam ettirmiş oluyoruz.</p>
</blockquote>

<p>İlginç olan bir başka kısım Base class&#39;ta tanımlı şurasıdır:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span>  public void Dispose()
<span class="lineno">2</span>  {
<span class="lineno">3</span>      Dispose(true);
<span class="lineno">4</span>      GC.SuppressFinalize(this);
<span class="lineno">5</span>  }
</code></pre></div>
<p>Bu kodda Dispose metodu işini bitirdikten sonra managed ve unmanaged tüm kaynakları dispose etti, ve artık GC&#39;nin Finalize metoduna gerek kalmadı.</p>

<p>Böylece Dispose pattern&#39;i eğer doğru kullanılırsa ilk baştan doğan Finalization&#39;dan kaynaklanan yaşam süresinin uzaması problemini de aşmış oluyoruz.</p>

<blockquote>
<p>Sonuç olarak eğer yapılabiliyorsa <em>IDisposable</em> nesnelerimizi aşağıdaki using statement&#39;ı ile birlilkte kullanmamız performans ve güvenlik açısından doğru olmaktadır:</p>
</blockquote>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno">1</span>  <span class="k">using</span> <span class="p">(</span><span class="n">Derived</span> <span class="n">d1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">(</span><span class="s">&quot;d1&quot;</span><span class="p">,</span> <span class="n">tracking</span><span class="p">))</span>
<span class="lineno">2</span>  <span class="p">{</span>
<span class="lineno">3</span>     <span class="c1">//d1 işlemleri</span>
<span class="lineno">4</span>     <span class="c1">//implicit disposing</span>
<span class="lineno">5</span>  <span class="p">}</span>
</code></pre></div>
<p><a href="http://www.codeproject.com/Articles/15360/Implementing-IDisposable-and-the-Dispose-Pattern-P">Konu ile ilgili daha ayrıntılı anlatılan bir örnek</a></p>

<h1>GC Options</h1>

<h2>Modlar</h2>

<p>Sadece 2 GC Modu vardır.</p>

<p>Tek işlemcili bilgisayarlarda default <strong>workstation</strong> modu en hızlı olan seçenek olacaktır.</p>

<p>2 işlemcili bilgisayarlarda <strong>workstation</strong> ya da <strong>server</strong> modu kullanılabilir.</p>

<p><strong>Server</strong> GC modu 2&#39;den fazla işlemcili bilgisayarlarda en hızlı olacaktır.</p>

<p>Kodun hangi modda çalıştığını öğrenmek için şu komut kullanılabilir:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> bool isServerGC = GCSettings.IsServerGC();
</code></pre></div>
<p>Server gc maximum işlem hacmi için optimize edilmiştir. Bu her processor için bir GC thread&#39;inin paralel olarak çalışacağı anlamına gelmektedir.</p>

<p>Workstation gc hızı (responsiveness) ön plana çıkarır: belli bir zamanda az iş yapılır ancak uygulama belli hareketlere daha hızlı cevap verir.</p>

<p>Bu nedenle bir bilgisayarda birden fazla uygulama çalışıyorsa server gc yerine workstation gc&#39;yi tercih edebilirsiniz.</p>

<p>Config üzerinden <strong>server</strong> moduna ayarlamak için:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno">1</span> <span class="nt">&lt;configuration&gt;</span>
<span class="lineno">2</span>    <span class="nt">&lt;runtime&gt;</span>
<span class="lineno">3</span>       <span class="nt">&lt;gcServer</span> <span class="na">enabled=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="lineno">4</span>    <span class="nt">&lt;/runtime&gt;</span>
<span class="lineno">5</span> <span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<h2>Concurrency</h2>

<p>.NET Framework 4.0 ile beraber workstation concurrent gc, background gc ile değiştirildi ve .NET Framework 4.5 ile beraber de server gc için  kullanılabilir hale geldi.</p>

<p><gcConcurrent> elementi ile bu davranışı kontrol edebiliriz.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno">1</span> <span class="nt">&lt;configuration&gt;</span>
<span class="lineno">2</span>    <span class="nt">&lt;runtime&gt;</span>
<span class="lineno">3</span>         <span class="nt">&lt;gcConcurrent</span> <span class="na">enabled=</span><span class="s">“true</span> <span class="err">|</span> <span class="err">false”</span><span class="nt">/&gt;</span>
<span class="lineno">4</span>    <span class="nt">&lt;/runtime&gt;</span>
<span class="lineno">5</span> <span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<p>Concurrent gc, gc işlemi esnasında ekran takılmalarını minimize etmek için tasarlanmıştır. Bu yüzden etkileşimli UI uygulamaları için uygundur. Server ile ilgili işlemler yapmadıkça bu modu aktif olarak tutmak isteyeceksinizdir.</p>

<h2>Runtime GC Latency Control</h2>

<p>.NET GC latency modunu programatik olarak değiştirmenize izin verir.</p>

<p>3 mod vardır:</p>

<ul>
<li><strong>GCLatencyMode.Batch</strong> – UI etkileşimi önemli olmayan yerlerde maximum işlem ve performans verir.</li>
<li><strong>GCLatencyMode.LowLatency</strong> – UI etkileşiminin önemli olduğu yerlerde GC&#39;nin etkisini minimuma indirir. ör: animasyon</li>
<li><strong>GCLatencyMode.Interactive</strong> – Concurrency açık Workstation gc modu, GC verimliliği ve uygulama etkileşimi arasında dengeli.</li>
</ul>

<p>Maximum UI ya da işlem gerektiren kritik yerlerde <strong>LatencyMode</strong>&#39;u değiştirmek anlamlı olacaktır. Daha sonra eski haline geri döndürmek gereklidir:</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno"> 1</span> <span class="k">using</span> <span class="nn">System.Runtime</span><span class="p">;</span>
<span class="lineno"> 2</span> <span class="err">…</span>
<span class="lineno"> 3</span> <span class="c1">// Store current latency mode</span>
<span class="lineno"> 4</span> <span class="n">GCLatencyMode</span> <span class="n">mode</span> <span class="p">=</span> <span class="n">GCSettings</span><span class="p">.</span><span class="n">LatencyMode</span><span class="p">;</span>
<span class="lineno"> 5</span> <span class="c1">// Set low latency mode</span>
<span class="lineno"> 6</span> <span class="n">GCSettings</span><span class="p">.</span><span class="n">LatencyMode</span> <span class="p">=</span> <span class="n">GCLatencyMode</span><span class="p">.</span><span class="n">LowLatency</span><span class="p">;</span>
<span class="lineno"> 7</span> <span class="k">try</span>
<span class="lineno"> 8</span> <span class="p">{</span>
<span class="lineno"> 9</span>    <span class="c1">// Do some critical animation work</span>
<span class="lineno">10</span> <span class="p">}</span>
<span class="lineno">11</span> <span class="k">finally</span>
<span class="lineno">12</span> <span class="p">{</span>
<span class="lineno">13</span>    <span class="c1">// Restore latency mode</span>
<span class="lineno">14</span>    <span class="n">GCSettings</span><span class="p">.</span><span class="n">LatencyMode</span> <span class="p">=</span> <span class="n">mode</span><span class="p">;</span>
<span class="lineno">15</span> <span class="p">}</span>
</code></pre></div>
<h1>Weak References</h1>

<p>Weak referanslar objeleri tutmanızı sağlarken aynı zamanda GC tarafından toplanmasına da izin verir. Büyük objelerde bazen kod içinde tekrar kullanılıp kullanılmayacağı belli olmayan durumlarda kullanmak isteyebilirsiniz.</p>

<p>Büyük bir objeyi instantiate etmek CPU zamanı gerektirir aynı zamanda onu yüklü tutmak da memory gerektirir.</p>

<p>Uygulamanız kullanıcının büyük veri yapılarında gezmesini sağlıyorken, bu verilerin bazılarına tekrar ulaşmak isteyecek bazılarına ise ulaşmayacaktır. Bu durumda bu yapıları weak referanslara çevirip GC&#39;nin ihtiyaç duyduğunda collect etmesini sağlayabilirsiniz.</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="lineno"> 1</span> <span class="c1">// Load a complex data structure</span>
<span class="lineno"> 2</span> <span class="n">Complex3dDataStructure</span> <span class="n">floor23</span><span class="p">=</span><span class="k">new</span> <span class="n">Complex3dDataStructure</span><span class="p">();</span>
<span class="lineno"> 3</span> <span class="n">floor23</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="err">“</span><span class="n">floor23</span><span class="p">.</span><span class="n">data</span><span class="err">”</span><span class="p">);</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="err">…</span> <span class="c1">// Do some work then</span>
<span class="lineno"> 6</span> <span class="c1">// Get a weak reference to it</span>
<span class="lineno"> 7</span> <span class="n">WeakReference</span> <span class="n">weakRef</span><span class="p">=</span><span class="k">new</span> <span class="n">WeakReference</span><span class="p">(</span><span class="n">floor23</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="c1">// Destroy the strong reference, keeping the weak reference</span>
<span class="lineno">10</span> <span class="n">floor23</span><span class="p">=</span><span class="k">null</span><span class="p">;</span>
<span class="lineno">11</span> <span class="err">…</span>
<span class="lineno">12</span> <span class="c1">// Some time later try and get a strong reference back</span>
<span class="lineno">13</span> <span class="n">floor23</span><span class="p">=(</span><span class="n">Complex3dDataStructure</span><span class="p">)</span><span class="n">weakRef</span><span class="p">.</span><span class="n">Target</span><span class="p">;</span>
<span class="lineno">14</span> <span class="c1">// recreate if weak ref was reclaimed</span>
<span class="lineno">15</span> <span class="k">if</span> <span class="p">(</span><span class="n">floor23</span><span class="p">==</span><span class="k">null</span><span class="p">)</span>
<span class="lineno">16</span> <span class="p">{</span>
<span class="lineno">17</span>    <span class="n">floor23</span><span class="p">=</span><span class="k">new</span> <span class="n">Complex3dDataStructure</span><span class="p">();</span>
<span class="lineno">18</span>    <span class="n">floor23</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="err">“</span><span class="n">floor23</span><span class="p">.</span><span class="n">data</span><span class="err">”</span><span class="p">);</span>
<span class="lineno">19</span> <span class="p">}</span>
</code></pre></div>
<h2>Short weak references</h2>

<p>Eğer objeniz finalizable değilse WeakReference constructor&#39;ına <strong>false</strong> geçilir.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> WeakReference wr=WeakReference(floor23, false);
</code></pre></div>
<p>GC&#39;nin &quot;kullanılan objeler&quot; listesinde değilse silinir.</p>

<h2>Long weak references</h2>

<p>Bunun yanında finalizable nesnemiz varsa constructor&#39;a <strong>true</strong> geçilir.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> WeakReference wr=WeakReference(floor23, true);
</code></pre></div>
<p>Eğer obje “kullanılan objeler” listesinde ya da finalization queue&#39;da değilse silinebilir.</p>

					<div class="meta">
						<p class="date-publish">
							Published:
							<date class="date-pub" title="2015-11-14T00:00:00+02:00" datetime="2015-11-14T00:00:00+02:00" pubdate>
							<span class="month"><abbr>November</abbr></span>
							<span class="day">14</span>
							<span class="year">2015</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
    
    	<li><a href="/categories.html#.net-ref">
    		.net <span>2</span>
    	</a></li>
    
    	<li><a href="/categories.html#memory-ref">
    		memory <span>1</span>
    	</a></li>
    
  



						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
    
    	<li><a href="/tags.html#.net-ref">.net <span>2</span></a></li>
    
    	<li><a href="/tags.html#memory-ref">memory <span>1</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="mustapha_alaziz" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/mustapha_alaziz" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					<div class="comment">
					


  <div id="disqus_thread"></div>
<script type="text/javascript">
    

    
    var disqus_shortname = 'dhalsimblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/javascript/2015/11/14/es6" title="View ES6">&laquo; ES6</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/software/2015/11/14/software-development-processes" title="View Yazılım Geliştirme Modelleri">Yazılım Geliştirme Modelleri &raquo;</a></li>
							
						</ul>
					</nav>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>Hakkımda</h4>
					<img src="/assets/me_rounded.png" style="width: 150px" />
					<ul>
						<li class="contact"><span class="author fn n">Barış Aydek</span></li>
						<li class="resume"><a href="/resume/cv-tr">Özgeçmişim</a> | <a href="/assets/resume/cv-tr.pdf">pdf</a></li>
						<li class="contact"><address><span class="fn email"><a href="mailto:baris.aydek@gmail.com">baris.aydek@gmail.com</a></span></address></li>
						<li class="github"><a href="http://github.com/dhalsim/" rel="me">github.com/dhalsim</a></li>
						<li class="twitter"><a href="http://twitter.com/mustapha_alaziz/" rel="me">twitter.com/mustapha_alaziz</a></li>
						<li class="linkedin"><a href="https://www.linkedin.com/in/baris-aydek-39352325" rel="me">linkedin.com</a></li>
					</ul>
				</div><!-- misc -->
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/.net/memory/2015/11/14/net-memory-ynetimi-ve-memory-leaks" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" charset="utf-8"></script>
<script type="text/javascript">
$(document).ready(function(){
	// browser window scroll (in pixels) after which the "back to top" link is shown
	var offset = 300,
	//browser window scroll (in pixels) after which the "back to top" link opacity is reduced
	offset_opacity = 1200,
	//duration of the top scrolling animation (in ms)
	scroll_top_duration = 700,
	//grab the "back to top" link
	$back_to_top = $('.cd-top');

	//hide or show the "back to top" link
	$(window).scroll(function(){
		( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
		if( $(this).scrollTop() > offset_opacity ) {
			$back_to_top.addClass('cd-fade-out');
		}
	});

	//smooth scroll to top
	$back_to_top.on('click', function(event){
		event.preventDefault();
		$('body,html').animate({
			scrollTop: 0 ,
		 	}, scroll_top_duration
		);
	});
});
</script>


<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js" charset="utf-8"></script>
<script type="text/javascript">
	$(document).ready(function () {
		anchors.add('.content h1');
		anchors.add('.content h2');
		anchors.add('.content h3');
		anchors.add('.content h4');
		anchors.add('.content h5');

		var level = 1;
		var $parentUl = $currentUl = $('<ul/>');
		var count = 0;
		var listTypes = ['decimal', 'lower-alpha', 'circle']
		$('.anchorjs-link').each(function () {
			count++;
			if(count === 1)
			{
				return true;
			}

			var $this = $(this);
			var $parent = $this.parent();
			var tagName = $parent.prop("tagName");
			var thisLevel = tagName.charAt(1);
			var text = $parent.text();

			if(thisLevel > level) {
				var $newUl = $('<ul/>');
				$currentUl.append($newUl);
				$currentUl = $newUl;
			} else if(thisLevel < level) {
				var diff = level - thisLevel;
				$currentUl = $currentUl.parents().eq(diff-1);
			}

			var $a = $('<a/>');
			$a.text(text);
			$a.attr('href', $this.attr('href'));

			level = thisLevel;
			$currentUl.css('list-style', listTypes[level - 1]);
			$currentUl.append($('<li/>').append($a));
		});

		$('.content header').append(
			$('.toc').html(
				$('<h4/>', {text: 'İçindekiler: '})
			).append($parentUl)
		);

		$('.content img')
			.attr('title', 'Resmi büyütmek için üstüne tıklayınız.')
			.click(function (e) {
				var img = $('<img/>', {src: this.src});
				return $.fancybox(img);
			});
	});
</script>


  





  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-70097547-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




</body>
</html>

