

<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="tr"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Vagrant</title>
	<meta name="author" content="Barış Aydek">

	<!-- for Google -->
	<meta name="description" content="Vagrant sanal makine yöneticisini node.js uygulamamızı çalıştırmak için kullanıyoruz." />
	<meta name="keywords" content="" />

	<meta name="author" content="Barış Aydek" />
	<meta name="copyright" content="" />
	<meta name="application-name" content="Dhalsim's" />

	<!-- for Facebook -->
	<meta property="og:title" content="Vagrant" />
	<meta property="og:type" content="article" />
	<meta property="og:image" content="http://dhalsim.github.io/assets/images/vagrant.png" />
	<meta property="og:url" content="http://dhalsim.github.io/virtual-machines/2015/11/14/vagrant" />
	<meta property="og:description" content="Vagrant sanal makine yöneticisini node.js uygulamamızı çalıştırmak için kullanıyoruz." />

	<!-- for Twitter -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content="Vagrant" />
	<meta name="twitter:description" content="Vagrant sanal makine yöneticisini node.js uygulamamızı çalıştırmak için kullanıyoruz." />
	<meta name="twitter:image" content="http://dhalsim.github.io/assets/images/vagrant.png" />
	<meta name="twitter:creator" content="@">

  <style>
	  @font-face {
			font-family: 'Allerta';
			src: url('/assets/fonts/Allerta-Regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/Allerta-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/Allerta-Regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/Allerta-Regular.woff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/Allerta-Regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/Allerta-Regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}
		@font-face {
			font-family: 'Punk';
			src: url('/assets/fonts/punk-regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/punk-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/punk-regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/punk-regularwoff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/punk-regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/punk-regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}

		@font-face {
			font-family: 'Ewert';
			src: url('/assets/fonts/Ewert-Regular.eot'); /* IE9 Compat Modes */
			src: url('/assets/fonts/Ewert-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('/assets/fonts/Ewert-Regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('/assets/fonts/Ewert-Regularwoff') format('woff'), /* Pretty Modern Browsers */
					 url('/assets/fonts/Ewert-Regular.ttf')  format('truetype'), /* Safari, Android, iOS */
					 url('/assets/fonts/Ewert-Regular.svg#svgFontName') format('svg'); /* Legacy iOS */
		}
	</style>
	<link href='/assets/themes/the-program/css/style.css' rel="stylesheet" media="all">
	<link href='/assets/css/mystyles.css' rel="stylesheet" media="all">
	<link href='/assets/css/flags/flags.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title="Vagrant" type="application/atom+xml">
	
	<style media="screen">
	.cd-top {
	  display: inline-block;
	  height: 40px;
	  width: 40px;
	  position: fixed;
	  bottom: 100px;
	  right: 10px;
	  z-index: 10;
	  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
	  /* image replacement properties */
	  overflow: hidden;
	  text-indent: 100%;
	  white-space: nowrap;
	  background: rgba(232, 98, 86, 0.8) url(/assets/images/cd-top-arrow.svg) no-repeat center 50%;
	  visibility: hidden;
	  opacity: 0;
	  -webkit-transition: opacity .3s 0s, visibility 0s .3s;
	  -moz-transition: opacity .3s 0s, visibility 0s .3s;
	  transition: opacity .3s 0s, visibility 0s .3s;
	}
	.cd-top.cd-is-visible, .cd-top.cd-fade-out, .no-touch .cd-top:hover {
	  -webkit-transition: opacity .3s 0s, visibility 0s 0s;
	  -moz-transition: opacity .3s 0s, visibility 0s 0s;
	  transition: opacity .3s 0s, visibility 0s 0s;
	}
	.cd-top.cd-is-visible {
	  /* the button becomes visible */
	  visibility: visible;
	  opacity: 1;
	}
	.cd-top.cd-fade-out {
	  /* if the user keeps scrolling down, the button is out of focus and becomes less visible */
	  opacity: .5;
	}
	.no-touch .cd-top:hover {
	  background-color: #e86256;
	  opacity: 1;
	}
	@media only screen and (min-width: 768px) {
	  .cd-top {
	    right: 20px;
	    bottom: 20px;
	  }
	}
	@media only screen and (min-width: 1024px) {
	  .cd-top {
	    height: 60px;
	    width: 60px;
	    right: 30px;
	    bottom: 30px;
	  }
	}
	</style>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" charset="utf-8">
	
</head>
<body>
<a href="#0" class="cd-top cd-is-visible">Top</a>
<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<nav class="nav-global">
					<ul>
						<li class="logo" style="height: 249px;">
							<a href="">
								<img src="/assets/dhalsim_logo.gif" />
							</a>
						</li>
						<li class="logo">
							<a href="/">
								Dhalsim's
							</a>
						</li>
						<li class="archive"><a href="/archive.html">Arşiv</a></li>
						<li class="page"><a href="/pages.html">Sayfalar</a></li>
						<li class="category"><a href="/categories.html">Kategoriler</a></li>
						<li class="tag"><a href="/tags.html">Taglar</a></li>
					</ul>

					<hr />
					<nav class="languageSelector">
						
							<a href="/en" ><img src="/assets/blank.gif" class="flag flag-gb" alt="İngilizce" /> </a><a href="/en" class="alink">İngilizce</a>
						
						-
						
							<img src="/assets/blank.gif" class="flag flag-tr" alt="Türkçe" /> Türkçe
						
					</nav>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					

<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Vagrant</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
				
				<div class="toc">
					<span>İçindekiler tablosu yükleniyor...</span>
					<div class="sp-circle"></div>
				</div>
				
			</header>

			<div class="bd">
				<div class="entry-content">
					<blockquote>
<p>Not: Vagrant VM kullanıcısı <code>vagrant</code>, parolası <code>vagrant</code>&#39;tır.</p>
</blockquote>

<h1>Vagrant ne işe yarıyor</h1>

<p>Vagrant bir sanal makine yöneticisi. Bilgisayarınızdaki sanal makinelerin oluşturulmasından kurulumuna, çalıştırılmasına ve izlenmesine yönelik kolaylıklar sunuyor. Açık kaynak ve cross-platform (MacOS, Windows, Linux) bir yazılım. Şu anda VMWare, VirtualBox ve AWS (Amazon Web Services) üzerinden oluşturulan VM&#39;leri yönetebiliyorsunuz. Bu ne demek oluyor? Aynı Vagrant konfigürasyonu üzerinden farklı VM&#39;leri çok rahat kullanabiliyorsunuz.</p>

<p>Peki bu bizim gerçek hayatta ne işimize yarayacak? Örnekler ne olabilir?</p>

<p>Öncelikle <em>development</em> kalitesini arttıran bir yönü var. Şirkete ilk başladığınızda projeyi kendi bilgisayarınızda ayağa kaldırmak için ne kadar uğraştınızı hatırlıyor musunuz? </p>

<p>Ya da tüm bu işlemleri <em>staging</em>, <em>test</em> ve <em>production</em> ortamlarına da yapmak yaşlanmanıza neden olabilir. Diyelim ki deployment sürecinize yeni bir ortam ekliyorsunuz (mesela <em>UAT</em> için) ve yeni bir makine, yeni kurulum yapmanız gerekiyor. Uygulamanızın tüm bağımlılıklarının o makineye kurulması gerekiyor. Bu projenizin büyüklüğüne göre bazen bir haftayı bulan süreçlere uzayabilir.</p>

<p>Ancak vagrant&#39;ın belki de en yararlı olduğu konu <em>production</em> ortamındaki hatalarının <em>development</em>&#39;da yakalanabilmesini sağlaması. &quot;Bende çalışıyor&quot; - &quot;Kendi ortamımda reproduce edemedim&quot; gibi iğrenç söylemler tarih oluyor :)</p>

<p><img src="/assets/images/disastergirl.jpg" alt=""></p>

<h1>Gereksinimler</h1>

<p>Vagrant provider olarak kullanacağı bir VM yöneticisine ihtiyaç duyuyor. Birçok provider desteklendiğini daha önceden söylemiştik. Bu yazı için varsayılan olarak sunulan ve yine açık kaynak ücretsiz VM <strong>VirtualBox</strong>&#39;ı kullandım. Virtualbox&#39;ı indirmek için: <a href="https://www.virtualbox.org/wiki/Downloads">tıklayın</a>.</p>

<h1>Vagrant kurulumu</h1>

<ol>
<li>Bir adet vagrant <a href="http://www.vagrantup.com/downloads">http://www.vagrantup.com/downloads</a></li>
</ol>

<h1>Box konumunu ayarlamak</h1>

<blockquote>
<p>Not: Bu anlatım Mac OS X veya Linux için geçerlidir</p>
</blockquote>

<p>Vagrant&#39;ın indirdiği box dosyaları default yeri:</p>

<p><code>~/.vagrant.d/boxes</code></p>

<p>Çok yer kaplayabileceğinden ötürü bu folder&#39;ı değiştirmek isterseniz
favori text editörünüzde <code>.bash_profile</code> dosyanızı açın: (<em>nano</em> yerine <em>vi</em> de kullanabilirsiniz)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> sudo nano ~/.bash_profile
</code></pre></div>
<p>Şu satırı ekleyin:</p>

<p><code>export VAGRANT_HOME=&quot;/&lt;BURAYA ISTEDIGIN FOLDERI YAZ&gt;&quot;</code>
Artık indirilip oluşturulan VM dosyaları istediğimiz bir folder altında olacak.</p>

<h1>İşletim sistemi kurmak</h1>

<p>Harshi Corp.&#39;un Atlas&#39;ı üzerinde birçok Linux seçeneği mevcut tabii ancak Ubuntu aşina olduğum bir dağıtım ve <strong>LTE</strong> sürümü olduğundan seçiyorum: <a href="https://atlas.hashicorp.com/ubuntu/boxes/trusty64">https://atlas.hashicorp.com/ubuntu/boxes/trusty64</a></p>

<p>Dökümantasyonunda söylediği şekilde kuruyorum.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> vagrant init ubuntu/trusty64
<span class="lineno">2</span> vagrant up
</code></pre></div>
<p><strong>init</strong> komutu bulunduğumuz yerde bir <code>VagrantFile</code> yaratacaktır. Buradaki bilgilere göre <code>vagrant up</code> dediğimizde kurulum, bu ayarlar üzerinden gerçekleşecek.</p>

<p><strong>up</strong> komutuyla birlikte ilgili işletim sistemi dosyası indirilir ve o sanal makine çalıştırılır.</p>

<blockquote>
<p><code>vagrant --help</code> ile yararlı birçok komutu görebilirsiniz.</p>
</blockquote>

<h1>Box&#39;a bağlanmak</h1>

<p>öncelikle kurulu <em>box</em>&#39;ları görmek için: <code>vagrant box list</code> diyoruz.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> ubuntu/trusty64 (virtualbox, 20151020.0.0)
</code></pre></div>
<p>Şimdi de bağlanmak için <code>vagrant ssh</code> diyoruz, bu bizi VagrantFile&#39;daki sisteme bağlayacak.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> vagrant@vagrant-ubuntu-trusty-64:~$
</code></pre></div>
<p>Artık terminal bağlantım değişti, bu <strong>ssh</strong> ile bağlanabildiğimi gösteriyor.</p>

<h1>Gerekliliklerin kurulması</h1>

<blockquote>
<p>Aşağıdaki gereklilikler tamamen benim bu örnekte anlattığım <strong>node.js</strong> uygulaması ve onun bağımlılıklarını içerir.</p>
</blockquote>

<p>Uygulamamızı çalıştırmak için gerekli araçları kuracağız.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> sudo apt-get -y install git build-essential
<span class="lineno">2</span> curl --silent --location https://deb.nodesource.com/setup_4.x | sudo bash -
<span class="lineno">3</span> sudo apt-get install -y nodejs redis-server
<span class="lineno">4</span> sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10
<span class="lineno">5</span> echo &quot;deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.0 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list
<span class="lineno">6</span> sudo apt-get update
<span class="lineno">7</span> sudo apt-get install -y mongodb-org
</code></pre></div>
<p>Redis ayarlarımızı yapalım: (<em>vi</em> yerine <em>nano</em> da kullanabilirsiniz)
Uygulamamızın kullandığı konfigürasyon <em>redis.sh</em> scriptinde bu path kullanılıyor.
~~~
sudo vi /etc/redis/redis.conf
~~~</p>

<p><code>notify-keyspace-events</code> geçen satırı şu şekilde değiştirelim:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> notify-keyspace-events &quot;Kgs&quot;
</code></pre></div>
<p>Ardından redis&#39;i yeniden başlatalım:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> sudo service redis-server restart
</code></pre></div>
<p>Şimdi de uygulamayı indirip çalıştıralım:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> git clone https://github.com/dhalsim/chatcat.git
<span class="lineno">2</span> cd chatcat
<span class="lineno">3</span> git checkout dort
<span class="lineno">4</span> npm install
<span class="lineno">5</span> sudo npm install grunt-cli -g
</code></pre></div>
<p>Bu komutların hepsini bir dosyaya kaydediyoruz: <strong>provision.sh</strong>. Ardınan <code>VagrantFile</code>&#39;ı açıp düzenleme yapıyoruz. Şu şekile getirin:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span>  <span class="o">-*-</span> <span class="ss">mode</span><span class="p">:</span> <span class="n">ruby</span> <span class="o">-*-</span>
<span class="lineno">2</span> 
<span class="lineno">3</span> <span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="lineno">4</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/trusty64&quot;</span>
<span class="lineno">5</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>
<span class="lineno">6</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s2">&quot;provision.sh&quot;</span>
<span class="lineno">7</span> <span class="k">end</span>
</code></pre></div>
<p><strong>ssh</strong>&#39;tan <code>exit</code> ile çıkıyoruz:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> vagrant reload --provision
</code></pre></div>
<p>Böylece <em>vagrant</em>, VM&#39;i kapatacak, tekrar açacak ve verdiğimiz <code>provision.sh</code> dosyasından kurulum yapacak</p>

<h1>Vagrant senkronizasyon</h1>

<p>Vagrant VM&#39;ler üzerinde geliştirme yapmak özellikle grafik arabirimi olmadığından çok zor olabilir. terminal programlarıyla çok içli dışlı değilseniz, <em>host</em> makinenizdeki uygulamalarınızı kullanmak istiyorsanız, vagrant VM <em>guest</em> makineniz ile <em>host</em> makineniz arasında ortak senkronize dosyaları kullanabilirsiniz. Data transferi açısından da faydalıdır.</p>

<p>Burada Mac OSX <em>host</em> makinesi ve <em>VirtualBox</em> <em>ubuntu</em> <em>guest</em> makinesi arasındaki kullanımı anlatacağım. Sizde farklı bir kombinasyon varsa ve bunlar işe yaramazsa ayrıntılı bilgi <a href="https://docs.vagrantup.com/v2/synced-folders/index.html">vagrant dökümantasyonu</a>&#39;nda.</p>

<p>Şimdi <code>VagrantFile</code>&#39;ı değiştirelim:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="lineno">2</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/trusty64&quot;</span>
<span class="lineno">3</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>
<span class="lineno">4</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s2">&quot;provision.sh&quot;</span>
<span class="lineno">5</span>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;~/Projects/chatcat&quot;</span><span class="p">,</span> <span class="s2">&quot;/home/vagrant/chatcat&quot;</span>
<span class="lineno">6</span> <span class="k">end</span>
</code></pre></div>
<ul>
<li><strong>config.vm.synced_folder</strong> komutunu ekledik</li>
<li>ilk parametredeki <em>path</em>, <em>host</em> makinedeki</li>
<li>ikinci parametredeki <em>path</em>, <em>guest</em> makinesindeki yeri belirtiyor</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> vagrant reload
<span class="lineno">2</span> vagrant ssh
</code></pre></div>
<p>ile kontrol ediyoruz. Artık <em>host</em> makinemizde istediğimiz editör/IDE ile bir dosya değiştirdiğimizde otomatik olarak o dosya Vagrant tarafından <em>guest</em> makineye senkron edilecek.</p>

<h1>Port Forwarding</h1>

<p>Port forwarding, vagrant box&#39;da çalışan bir portu benim bilgisayarımın başka bir portuna yönlendirmek/bağlamak anlamına geliyor.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> config.vm.network &quot;forwarded_port&quot;, guest: 3000, host: 3000
</code></pre></div>
<p>Artık VM&#39;in 3000 portu, bizim bilgisayarımızın 3000 portuna yönlenmekte.</p>

<p>Kendi bilgisayarınızda <a href="http://localhost:3000">http://localhost:3000</a>&#39;den uygulamamızı deneyebiliriz. Afiyet olsun :)</p>

<h1>Private Network</h1>

<p>Vagrant sanal makinelerinizin bir private network altında birbirleriyle haberleşebilmelerini sağlayabilirsiniz. Bunun için yapmanız gereken:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> config.vm.network &quot;private_network&quot;, ip: &quot;192.168.1.20&quot;
</code></pre></div>
<blockquote>
<p>Bu yöntemle port forwarding yapmamıza gerek kalmıyor. O satırı silip <em>localhost</em> yerine <a href="http://192.168.1.20:3000">http://192.168.1.20:3000</a> üzerinden de uygulamayı çalıştırabilirsiniz.</p>
</blockquote>

<p><em>Guest OS</em> (konuk işletim sistemi) için bir IP tanımlamak. Ayrıca VM&#39;inizin <em>Host OS</em> (yönetici işletim sistemi) DNS&#39;ini veya başka bir DNS server&#39;ını kullanmasını sağlayabilirsiniz.</p>

<p>VirtualBox için bu şu komutla yapılabiliyor: (VM&#39;in kapalı olduğundan emin olun: <code>vagrant halt</code>)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> VBoxManage list vms  --&gt; VM listesinden ismi alıp aşağıya yazın
<span class="lineno">2</span> VBoxManage modifyvm &quot;VM İSMİNİZİ BURAYA YAZIN&quot; --natdnshostresolver1 on
</code></pre></div>
<p>Eğer sürekli IP hatırlamakla uğraşmak istemiyorsanız <em>hosts</em> dosyasına anlamlı isimler verebilirsiniz. Mac OSX için dosyayı değiştirelim (<em>vi</em> yerine <em>nano</em> da kullanabilirsiniz)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> sudo vi /private/etc/hosts  
</code></pre></div>
<p>En alt satıra <code>192.168.1.20 nodeapp.com</code> ekleyip kaydedin. Daha sonra <a href="http://nodeapp.com:3000">http://nodeapp.com:3000</a> şeklinde o vagrant üzerindeki node.js uygulamamıza erişebileceğiz. Üstelik eğer diğer VM&#39;lerde de <strong>VBoxManage</strong> ile yaptığımızı yaparsak, aynı network ve DNS ayarları üzerinden onlar da erişebilirler. <strong>Bundan sonraki anlatımlarda <em>nodeapp.com</em> üzerinden gideceğim</strong>.</p>

<blockquote>
<p>Bu yaptığımız değişiklik <em>facebook login</em> işlemlerinde ve <em>socket</em> işlemlerinde probleme yol açacak. Facebook application ayarlarından <strong>localhost</strong> geçen yerleri <strong>nodeapp.com</strong> ile değiştirmemiz gerekiyor. Bunlar <em>config/commons.js</em>&#39;te <strong>socket_host</strong> değişkeli ve <em>test.json</em>&#39;da değiştireceğimiz <strong>callbackURL</strong> değişkenidir. Yapılması gerekenler:</p>
</blockquote>

<ol>
<li><a href="http://developers.facebook.com">http://developers.facebook.com</a> üzerinden uygulamamızın ayarlarını değiştirmeliyiz. Benim önerim <strong>Test Apps</strong> üzerinden yeni bir test uygulaması yaratıp, Site URL&#39;i <em>http://nodeapp.com:3000/</em> şeklinde ayarlamanız. Bu durumda <strong>test.json</strong>&#39;a yeni AppID ve AppSecret değişkenlerini güncellemeyi unutmayın</li>
<li><p><em>config/index.js</em>&#39;te daha önceden farketmediğim bir durum var. Onu düzelteceğiz. Normalde yapılması gereken, ortak ayarların ezilmesini sağlamaktır. <strong>commons</strong> ve <strong>environmentConfig</strong> yer değiştirecek:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> module.exports = require(&#39;src/lib/utils&#39;).extend(commons, environmentConfig);
</code></pre></div></li>
<li><p><em>test.json</em>&#39;a <em>commons.json</em>&#39;daki <strong>socket_host</strong>&#39;u ezebilmek için şunu ekliyoruz:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> ...
<span class="lineno">2</span> &quot;socket_host&quot;: &quot;http://nodeapp.com:3000&quot;,
<span class="lineno">3</span> ...
</code></pre></div></li>
</ol>

<p>Bu en çok VM&#39;leriniz arasında iletişim kurmak istediğinizde -ki bunu isteyeceksiniz- IP&#39;ler yerine FQDN&#39;lerle (nodeapp.com gibi) yapabilmenizi sağlayacak.</p>

<h1>Uygulamayı servis olarak çalıştırmak</h1>

<blockquote>
<p>Şimdiye kadar Vagrant üzerinden node.js uygulamamızı Ubuntu/Linux&#39;a kurulumunu ve çalıştırılmasını anlattım. Şimdi ise uygulamamızın yönetimini ve izlenmesini sağlayacak <strong>PM2</strong> ismindeki aracın kullanımını göreceğiz. Üstelik PM2 ile uygulamanın <em>crash</em> olması durumunda yeniden başlatılmasını da sağlayacağız. Ayrınca herhangi bir VM restart durumunda da uygulamanın servis olarak otomatik çalışmasını sağlayacağız.</p>
</blockquote>

<p>Uygulamamızı VM&#39;i başlattığımızda otomatik başlaması için ayarlamamız gerekiyor. Bu aynı zamanda VM&#39;in yeniden başlamalarında da gerekli olacaktır.</p>

<p>PM2&#39;yi kuruyoruz:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> sudo npm install -g pm2
</code></pre></div>
<p>PM2&#39;nun karışık komutlarında bize bir nebze olsun yardımcı olacak komut tamamlama için:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> pm2 completion install
</code></pre></div>
<p>Bulunduğunuz terminalde işe yaraması için gerekli komut, olmuyorsa terminal penceresini/tabını kapatıp açabilirsiniz de:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno">1</span> source ~/.bashrc
</code></pre></div>
<blockquote>
<p><strong>NOT:</strong> pm2 aslında bizim işimize yarayacak birçok özelliğe sahip ancak bu yazının konusunu aştığından buna başka bir yazıda değineceğim. Siz isterseniz araştırabilirsiniz, faydalıdır. <a href="http://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/">http://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/</a></p>
</blockquote>

<p>Servis ayarlarına girmeden önce <strong>grunt</strong> tarafında değişiklikler yapacağız. Şimdiye kadar uygulamamız <em>dev</em> modunda çalışıyordu. VM için <em>test</em> modunu kullanmaya karar verdim. Siz kafanıza göre ayarlayabilirsiniz. Bana göre servis olarak çalıştırırken de <em>redis</em>, <em>mongo</em> gibi kullanılan tüm program ve ayarlar en rahat yine <strong>grunt</strong> ile ayarlanabiliyor, ancak bu sefer <em>development</em> için kullandığımız <em>watch</em>, <em>nodemon</em> gibi araçlar yerine <strong>pm2</strong> kullanacağız. Uzatmadan yapmamız gerekenlere geçersek:</p>

<blockquote>
<p><strong>Spoiler:</strong> Programın vagrant için hazır halini <code>git checkout bes</code> diyerek kullanabilirsiniz. O durumda aşağıda yapılan değişikliklerden bazılarına gerek kalmayacak.</p>
</blockquote>

<ol>
<li><code>dev.json</code> dosyasının içeriğini <code>test.json</code> dosyasına kopyalayın. Kolaylık olması açısından VM üzerinde de <strong>cloud</strong> yerine aynı makinedeki servis olarak çalışan <em>redis</em>, <em>mongo</em> kullanılacak.</li>
<li><code>service --status-all</code> ile redis, mongo servislerinin çalıştığından emin olun</li>
<li><em>console</em>&#39;dan <strong><code>NODE_ENV=test pm2 start app.js</code></strong> ile test edin.<br></li>
<li>çalışıyorsa <code>pm2 kill</code> ile kapatın</li>
<li><p><strong><code>startup.sh</code></strong> adında yeni bir dosya ekliyoruz. Bu dosya bizim oluşturacağımız servis&#39;in çalışmasını, durdurulmasını vs. sağlayacak. Kontrol edilmesi gereken yerler <strong>NAME, PM2, USER, APP_HOME</strong> gibi değişkenler. Mesela user&#39;ın <code>whoami</code> ile kontrolünü yapabilirsiniz. <code>which pm2</code> diyerek pm2&#39;nun asıl yerini öğrenebilirsiniz.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="lineno"> 1</span> <span class="c">#!/bin/bash</span>
<span class="lineno"> 2</span>  chkconfig: <span class="m">2345</span> <span class="m">98</span> 02
<span class="lineno"> 3</span> <span class="c">#</span>
<span class="lineno"> 4</span>  description: our chatcat node app startup script
<span class="lineno"> 5</span>  processname: chatcat
<span class="lineno"> 6</span> <span class="c">#</span>
<span class="lineno"> 7</span> <span class="c">## BEGIN INIT INFO</span>
<span class="lineno"> 8</span>  Provides:
<span class="lineno"> 9</span>  Required-Start: <span class="nv">$local_fs</span> <span class="nv">$remote_fs</span>
<span class="lineno">10</span>  Required-Stop: <span class="nv">$local_fs</span> <span class="nv">$remote_fs</span>
<span class="lineno">11</span>  Should-Start: <span class="nv">$network</span>
<span class="lineno">12</span>  Should-Stop: <span class="nv">$network</span>
<span class="lineno">13</span>  Default-Start:        <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> 5
<span class="lineno">14</span>  Default-Stop:         <span class="m">0</span> <span class="m">1</span> 6
<span class="lineno">15</span>  Short-Description: chatcat
<span class="lineno">16</span>  Description: chatcat node app is started
<span class="lineno">17</span> <span class="c">## END INIT INFO</span>
<span class="lineno">18</span> 
<span class="lineno">19</span> <span class="nv">NAME</span><span class="o">=</span>chatcat
<span class="lineno">20</span> <span class="nv">PM2</span><span class="o">=</span>/usr/bin/pm2
<span class="lineno">21</span> <span class="nv">USER</span><span class="o">=</span>vagrant
<span class="lineno">22</span> <span class="nv">APP_HOME</span><span class="o">=</span><span class="s2">&quot;/home/vagrant/chatcat&quot;</span>
<span class="lineno">23</span> 
<span class="lineno">24</span> <span class="nb">export </span><span class="nv">NODE_ENV</span><span class="o">=</span><span class="s2">&quot;test&quot;</span>
<span class="lineno">25</span> 
<span class="lineno">26</span> get_user_shell<span class="o">()</span> <span class="o">{</span>
<span class="lineno">27</span>     <span class="nb">local </span><span class="nv">shell</span><span class="o">=</span><span class="k">$(</span>getent passwd <span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="sb">`</span>whoami<span class="sb">`</span><span class="k">}</span> <span class="p">|</span> cut -d: -f7 <span class="p">|</span> sed -e <span class="s1">&#39;s/[[:space:]]*$//&#39;</span><span class="k">)</span>
<span class="lineno">28</span> 
<span class="lineno">29</span>     <span class="k">if</span> <span class="o">[[</span> <span class="nv">$shell</span> <span class="o">==</span> *<span class="s2">&quot;/sbin/nologin&quot;</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">[[</span> <span class="nv">$shell</span> <span class="o">==</span> <span class="s2">&quot;/bin/false&quot;</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">[[</span> -z <span class="s2">&quot;$shell&quot;</span> <span class="o">]]</span><span class="p">;</span>
<span class="lineno">30</span>     <span class="k">then</span>
<span class="lineno">31</span>       <span class="nv">shell</span><span class="o">=</span><span class="s2">&quot;/bin/bash&quot;</span>
<span class="lineno">32</span>     <span class="k">fi</span>
<span class="lineno">33</span> 
<span class="lineno">34</span>     <span class="nb">echo</span> <span class="s2">&quot;$shell&quot;</span>
<span class="lineno">35</span> <span class="o">}</span>
<span class="lineno">36</span> 
<span class="lineno">37</span> super<span class="o">()</span> <span class="o">{</span>
<span class="lineno">38</span>     <span class="nb">local </span><span class="nv">shell</span><span class="o">=</span><span class="k">$(</span>get_user_shell <span class="nv">$USER</span><span class="k">)</span>
<span class="lineno">39</span>     su - <span class="nv">$USER</span> -s <span class="nv">$shell</span> -c <span class="s2">&quot;NODE_ENV=$NODE_ENV $*&quot;</span>
<span class="lineno">40</span> <span class="o">}</span>
<span class="lineno">41</span> 
<span class="lineno">42</span> start<span class="o">()</span> <span class="o">{</span>
<span class="lineno">43</span>     <span class="nb">echo</span> <span class="s2">&quot;Starting $NAME&quot;</span>
<span class="lineno">44</span>     super <span class="nv">$PM2</span> start <span class="nv">$APP_HOME</span>/app.js
<span class="lineno">45</span> <span class="o">}</span>
<span class="lineno">46</span> 
<span class="lineno">47</span> stop<span class="o">()</span> <span class="o">{</span>
<span class="lineno">48</span>     super <span class="nv">$PM2</span> dump
<span class="lineno">49</span>     super <span class="nv">$PM2</span> delete all
<span class="lineno">50</span>     super <span class="nv">$PM2</span> <span class="nb">kill</span>
<span class="lineno">51</span> <span class="o">}</span>
<span class="lineno">52</span> 
<span class="lineno">53</span> restart<span class="o">()</span> <span class="o">{</span>
<span class="lineno">54</span>     <span class="nb">echo</span> <span class="s2">&quot;Restarting $NAME&quot;</span>
<span class="lineno">55</span>     stop
<span class="lineno">56</span>     start
<span class="lineno">57</span> <span class="o">}</span>
<span class="lineno">58</span> 
<span class="lineno">59</span> reload<span class="o">()</span> <span class="o">{</span>
<span class="lineno">60</span>     <span class="nb">echo</span> <span class="s2">&quot;Reloading $NAME&quot;</span>
<span class="lineno">61</span>     super <span class="nv">$PM2</span> reload all
<span class="lineno">62</span> <span class="o">}</span>
<span class="lineno">63</span> 
<span class="lineno">64</span> status<span class="o">()</span> <span class="o">{</span>
<span class="lineno">65</span>     <span class="nb">echo</span> <span class="s2">&quot;Status for $NAME:&quot;</span>
<span class="lineno">66</span>     super <span class="nv">$PM2</span> list
<span class="lineno">67</span>     <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
<span class="lineno">68</span> <span class="o">}</span>
<span class="lineno">69</span> 
<span class="lineno">70</span> <span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
<span class="lineno">71</span>     start<span class="o">)</span>
<span class="lineno">72</span>         start
<span class="lineno">73</span>         <span class="p">;;</span>
<span class="lineno">74</span>     stop<span class="o">)</span>
<span class="lineno">75</span>         stop
<span class="lineno">76</span>         <span class="p">;;</span>
<span class="lineno">77</span>     status<span class="o">)</span>
<span class="lineno">78</span>         status
<span class="lineno">79</span>         <span class="p">;;</span>
<span class="lineno">80</span>     restart<span class="o">)</span>
<span class="lineno">81</span>         restart
<span class="lineno">82</span>         <span class="p">;;</span>
<span class="lineno">83</span>     reload<span class="o">)</span>
<span class="lineno">84</span>         reload
<span class="lineno">85</span>         <span class="p">;;</span>
<span class="lineno">86</span>     force-reload<span class="o">)</span>
<span class="lineno">87</span>         reload
<span class="lineno">88</span>         <span class="p">;;</span>
<span class="lineno">89</span>     *<span class="o">)</span>
<span class="lineno">90</span>         <span class="nb">echo</span> <span class="s2">&quot;Usage: {start|stop|status|restart|reload|force-reload}&quot;</span>
<span class="lineno">91</span>         <span class="nb">exit </span>1
<span class="lineno">92</span>         <span class="p">;;</span>
<span class="lineno">93</span> <span class="k">esac</span>
<span class="lineno">94</span> <span class="nb">exit</span> <span class="nv">$RETVAL</span>
</code></pre></div></li>
<li><p><code>sudo cp startup.sh /etc/init.d/nodeapp</code> ile dosyayı servislerin çalıştırıldığı path&#39;e kopyalayın</p></li>
<li><p><code>sudo chmod a+x /etc/init.d/nodeapp</code> ile dosyaya çalıştırma izni verin</p></li>
<li><p><code>sudo service nodeapp start</code> ile servisi başlatın. Denemek için <code>sudo /etc/init.d/nodeapp start</code> da diyebilirsiniz.</p></li>
<li><p><code>pm2 list</code> ile uygulamanın başlayıp başlamadığına emin olun</p></li>
<li><p><code>sudo service nodeapp stop</code> uygulamayı durdurun. <code>pm2 list</code> ile çalışan uygulama olmadığına emin olun. <code>ps aux | grep node</code> ile node.js&#39;in çalışmadığını görün.</p></li>
<li><p>Her şey OK ise servisi başlangıçta çalışması için şu komutu girelim: <code>sudo update-rc.d nodeapp defaults</code></p>

<blockquote>
<p>Not: Tüm bunları denerken bir problemle karşılaşırsanız basitten karmaşığa doğru ilerleyin. Önce <code>startup.sh</code>
çalışıyor mu. Daha sonra da service çalışıyor mu diye bakabilirsiniz.</p>
</blockquote></li>
<li><p>Ayrıca <code>provision.sh</code> dosyasında da değişiklik yapmamız gerekiyor:</p></li>
</ol>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span class="lineno"> 1</span> ...
<span class="lineno"> 2</span> git clone https://github.com/dhalsim/chatcat.git
<span class="lineno"> 3</span> cd chatcat
<span class="lineno"> 4</span> git checkout bes
<span class="lineno"> 5</span> npm install
<span class="lineno"> 6</span> sudo npm install grunt-cli -g
<span class="lineno"> 7</span> sudo npm install -g pm2
<span class="lineno"> 8</span> sudo cp startup.sh /etc/init.d/nodeapp
<span class="lineno"> 9</span> sudo chmod a+x /etc/init.d/nodeapp
<span class="lineno">10</span> sudo update-rc.d nodeapp defaults
</code></pre></div>
<p>Şimdilik bu kadar. Vagrant kullanması gerçekten hoş bir ortam sunmuş. Ancak <em>Linux</em> ile çok alakadar olmayan gençlerimiz yabancılık çekiyor olabilir. Linux ile ilgili tonlarca kaynak bulabilirsiniz. Biraz bakmanızda fayda var. Takıldığınız yerlerde yorumlara yazarsanız oradan da yardımcı olmaya çalışırım. </p>

<p>Bir sonraki yazımda uygulamamızı Vagrant üzerinden clustured şekilde nasıl çalıştıracağımızı ve böyle durumunlarda loglama nasıl yönetilir bunun üzerinde duracağım. Loglama açısından çok sağlam bir yazı bizi bekliyor :)</p>

					<div class="meta">
						<p class="date-publish">
							Published:
							<date class="date-pub" title="2015-11-14T00:00:00+01:00" datetime="2015-11-14T00:00:00+01:00" pubdate>
							<span class="month"><abbr>November</abbr></span>
							<span class="day">14</span>
							<span class="year">2015</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
    
    	<li><a href="/categories.html#virtual-machines-ref">
    		virtual-machines <span>1</span>
    	</a></li>
    
  



						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
    
    	<li><a href="/tags.html#vagrant-ref">vagrant <span>1</span></a></li>
    
    	<li><a href="/tags.html#ubuntu-ref">ubuntu <span>1</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					<div class="comment">
					


  <div id="disqus_thread"></div>
<script type="text/javascript">
    

    
    var disqus_shortname = 'dhalsimblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




					</div>
				</div><!-- misc-content -->
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/software/2015/11/14/software-development-processes" title="View Yazılım Geliştirme Modelleri">&laquo; Yazılım Geliştirme Modelleri</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/node.js/2015/11/15/multi-room-chat-application" title="View Çok Odalı Node.js Chat Uygulaması">Çok Odalı Node.js Chat Uygulaması &raquo;</a></li>
							
						</ul>
					</nav>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>Hakkımda</h4>
					<img src="/assets/me_rounded.png" style="width: 150px" />
					<ul>
						<li class="contact"><span class="author fn n">Barış Aydek</span></li>
						<li class="resume"><a href="/resume/cv-tr">Özgeçmişim HTML (basitleştirilmiş)</a> |
							<a href="/assets/resume/cv-tr.pdf">pdf (basitleştirilmiş)</a> |
							<a href="/assets/resume/cv-full-en.pdf">pdf (ingilizce)</a>
						</li>
						<li class="contact"><address><span class="fn email"><a href="mailto:baris.aydek@gmail.com">baris.aydek@gmail.com</a></span></address></li>
						<li class="github"><a href="http://github.com/dhalsim/" rel="me">github.com/dhalsim</a></li>
						<li class="linkedin"><a href="https://www.linkedin.com/in/baris-aydek-39352325" rel="me">linkedin.com</a></li>
					</ul>

					<hr />

					<a href=/software-testing>Software Testing & TDD</a> sunumuma göz at!

				</div><!-- misc -->
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/virtual-machines/2015/11/14/vagrant" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" charset="utf-8"></script>
<script type="text/javascript">
$(document).ready(function(){
	// browser window scroll (in pixels) after which the "back to top" link is shown
	var offset = 300,
	//browser window scroll (in pixels) after which the "back to top" link opacity is reduced
	offset_opacity = 1200,
	//duration of the top scrolling animation (in ms)
	scroll_top_duration = 700,
	//grab the "back to top" link
	$back_to_top = $('.cd-top');

	//hide or show the "back to top" link
	$(window).scroll(function(){
		( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
		if( $(this).scrollTop() > offset_opacity ) {
			$back_to_top.addClass('cd-fade-out');
		}
	});

	//smooth scroll to top
	$back_to_top.on('click', function(event){
		event.preventDefault();
		$('body,html').animate({
			scrollTop: 0 ,
		 	}, scroll_top_duration
		);
	});
});
</script>


<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js" charset="utf-8"></script>
<script type="text/javascript">
	$(document).ready(function () {
		anchors.add('.content h1');
		anchors.add('.content h2');
		anchors.add('.content h3');
		anchors.add('.content h4');
		anchors.add('.content h5');

		var level = 1;
		var $parentUl = $currentUl = $('<ul/>');
		var count = 0;
		var listTypes = ['decimal', 'lower-alpha', 'circle']
		$('.anchorjs-link').each(function () {
			count++;
			if(count === 1)
			{
				return true;
			}

			var $this = $(this);
			var $parent = $this.parent();
			var tagName = $parent.prop("tagName");
			var thisLevel = tagName.charAt(1);
			var text = $parent.text();

			if(thisLevel > level) {
				var $newUl = $('<ul/>');
				$currentUl.append($newUl);
				$currentUl = $newUl;
			} else if(thisLevel < level) {
				var diff = level - thisLevel;
				$currentUl = $currentUl.parents().eq(diff-1);
			}

			var $a = $('<a/>');
			$a.text(text);
			$a.attr('href', $this.attr('href'));

			level = thisLevel;
			$currentUl.css('list-style', listTypes[level - 1]);
			$currentUl.append($('<li/>').append($a));
		});

		$('.content header').append(
			$('.toc').html(
				$('<h4/>', {text: 'İçindekiler: '})
			).append($parentUl)
		);

		$('.content img')
			.attr('title', 'Resmi büyütmek için üstüne tıklayınız.')
			.click(function (e) {
				var img = $('<img/>', {src: this.src});
				return $.fancybox(img);
			});
	});
</script>




  





  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-70097547-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




</body>
</html>

